---
title: 'Endocrine aging is tied to navigational strategy in women'
author: "Shuying Yu"
date: "7/22/2022"
output: 
  html_document:
    toc: true
    toc_float: true
    toc_depth: 4
    theme: flatly
---

```{r setup, include=FALSE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE,
                      include = FALSE, fig.align = "center")

#Attach libraries
library(tidyverse)
library(here)
library(janitor)
library(ggpubr)
library(patchwork)
library(kableExtra)
library(foreign)
library(RColorBrewer)
library(plotly)
library(readr)
library(DescTools)
library(outliers)
library(rstatix)
library(coin) #for eff size of wilcoxon rank tests
library(ppcor)
```


*Modified on:* June 2023

# Introduction

This study aims to investigate the relationship between sex hormones and spatial navigation behavior in midlife women and men.

# Research Question

Do sex hormones (estradiol, progesterone, FSH) covary with measures of spatial navigation (LOOP, MAZE, DSP) for midlife women and men?

**Prediction:** The decline in ovarian estradiol production in midlife women will be associated with a shift in performance characteristics across spatial navigation paradigms, including an increased reliance on response-based strategies in the DSP task, fewer correct targets in the MAZE task, and more position errors in the LOOP task. For men, I hypothesize that lower testosterone concentrations will also be associated with an increased reliance on response-based strategies in the DSP task, fewer correct targets in the MAZE task, and more position errors in the LOOP task. 

Given our predictions for the direction of E and FSH in women, how does the correlation change if we investigate the relationships using one-tailed correlations?

Does the ratio of E/FSH, or E/P, among midlife women covary with position error in LOOP, accuracy in MAZE, or navigation strategy in DSP?


# Methods

## Participants

Midlife Adults

```{r include=TRUE, echo=FALSE}
#Table for final sample and age mean, sd for Aim 1
df_all <- read_csv(here("data", "HAS_SNAG_mastersheet_tidy.csv"))

#Filter for those with SNAG data
aim1 <- df_all %>% filter(completed_spatial == "Yes",
                          age_group == "Midlife") %>% 
  #Change subject_id to double
  mutate(subject_id = as.double(subject_id)) %>% 
   #Further exclude these subjects:
  filter(!subject_id %in% c(
    #"309", #bad participant
    #"316", #vertigo/took Wellbutrin for mood and Lipitor for cholesterol 7 days/week of scan
     "329", #on prednisone 7 days/week of scan
    #"352", #current MDD/depression
     "372" #past neuroschistosomiasis at 24 years old
  ))

#Filter for men
aim1_men <- aim1 %>% 
  filter(sex == "Male")
#Filter for women
aim1_women <- aim1 %>% 
  filter(sex == "Female") %>% 
  #Reorder repo status
  mutate(repo_status = fct_relevel(repo_status, 
                                  c("Pre", "Peri", "Post")))

#Table overall
tab_overall <- aim1 %>% 
  group_by(sex) %>% 
  summarize(n_subject = n(),
            age_mean = mean(age_spatial_years),
            age_Sd = sd(age_spatial_years))

#Table LOOP
tab_loop <- aim1 %>% 
  filter(loop_useable == "Yes") %>% 
  group_by(sex) %>% 
  summarize(n_subject = n(),
            age_mean = mean(age_spatial_years),
            age_Sd = sd(age_spatial_years))

#Table MAZE
tab_maze <- aim1 %>% 
  filter(maze_useable == "Yes") %>% 
  group_by(sex) %>% 
  summarize(n_subject = n(),
            age_mean = mean(age_spatial_years),
            age_Sd = sd(age_spatial_years))


#Table DSP
tab_dsp <- aim1 %>% 
  filter(dsp_useable == "Yes") %>% 
  group_by(sex) %>% 
  summarize(n_subject = n(),
            age_mean = mean(age_spatial_years),
            age_Sd = sd(age_spatial_years))


#Join df based on sex
tab1 <- merge(tab_overall, tab_loop, by = "sex")

#Rename columns
tab1 <- tab1 %>% 
  rename(n_subject_overall = n_subject.x,
         age_mean_overall = age_mean.x,
         age_sd_overall = age_Sd.x,
         n_subject_loop = n_subject.y,
         age_mean_loop = age_mean.y,
         age_sd_loop = age_Sd.y)

#Rest of the merge
tab2 <- merge(tab1, tab_maze, by = "sex")
tab_final <- merge(tab2, tab_dsp, by = "sex")


#Rename columns
tab_final <- tab_final %>% 
  rename(n_subject_maze = n_subject.x,
         age_mean_maze = age_mean.x,
         age_sd_maze = age_Sd.x,
         n_subject_dsp = n_subject.y,
         age_mean_dsp = age_mean.y,
         age_sd_dsp = age_Sd.y)

#Kable presentation (ideal if we had all hormones)
tab_final %>% 
  kable(col.names = c("Sex", "n","Mean Age","SD Age",
                      "n","Mean Age","SD Age",
                      "n","Mean Age","SD Age",
                      "n","Mean Age","SD Age"),
        caption = "Sample size and age for women and men grouped by overall completion of spatial navigation behavior.") %>% 
  kable_styling("striped", full_width = FALSE,
                position = "center", 
                font_size = 12) %>%
  add_header_above(c(" " = 1, "Overall" = 3, 
                     "LOOP" = 3, "MAZE" = 3, "DSP" = 3))
```

```{r basic-demographics}
#Education and verbal IQ
aim1_women %>% 
  summarize(mean_viq = mean(viq, na.rm = TRUE),
            sd_viq = sd(viq, na.rm = TRUE),
            mean_edu = mean(education_years, na.rm = TRUE),
            sd_edu = sd(education_years, na.rm = TRUE))


aim1_men %>% 
  summarize(mean_viq = mean(viq, na.rm = TRUE),
            sd_viq = sd(viq, na.rm = TRUE),
            mean_edu = mean(education_years, na.rm = TRUE),
            sd_edu = sd(education_years, na.rm = TRUE))

shapiro.test(aim1_women$viq) #yes
shapiro.test(aim1_men$viq) #yes
wilcox.test(aim1_women$viq, aim1_men$viq) #p = 0.39

shapiro.test(aim1_women$education_years) #yes
shapiro.test(aim1_men$education_years) #yes
wilcox.test(aim1_women$education_years,
            aim1_men$education_years) #yes, p < 0.001

#Ethnicity (% white)
aim1_women %>% 
  summarize(total_white = sum(ethnicity == "White", na.rm=TRUE),
            perc_white = total_white/n())

aim1_men %>% 
  summarize(total_white = sum(ethnicity == "White", na.rm=TRUE),
            perc_white = total_white/n())


#Age range by repo status
aim1_women %>% 
  filter(is.na(fsh_spatial_miu_ml) != TRUE) %>% 
  group_by(repo_status) %>% 
  summarize(count = n(),
            mean_age = mean(age_spatial_years, na.rm=TRUE),
            sd_age = sd(age_spatial_years, na.rm=TRUE),
            min_age = min(age_spatial_years),
            max_age = max(age_spatial_years))
```



**WOMEN**

Some women only had a few hormones available for analysis:

- 335: only have E, did LOOP

- 336: only have E, did MAZE

- 338: only have E, did LOOP and MAZE

- 344: only have E, did LOOP and MAZE

- 349: only have E, did LOOP

- 367: only have E & T, did LOOP and DSP

- 371: only have E & T, did only LOOP


Thus for women, sample sizes in the following correlation analyses are 

- Estradiol: *n* = 32 for LOOP, *n* = 64 for MAZE, and *n* = 47 for DSP.

- Progesterone: *n* = 26 for LOOP, *n* = 61 for MAZE, and *n* = 46 for DSP.

- FSH: *n* = 26 for LOOP, *n* = 61 for MAZE, and *n* = 46 for DSP.


**MEN**

- 365: only have SHBG, did LOOP and DSP

Thus for men, sample sizes in the following correlation analyses are *n* = 21 for LOOP, *n* = 23 for MAZE, and *n* = 28 for DSP.

What are the sample sizes for women by reproductive group?

```{r repo-women-n, include=TRUE}
aim1_women %>% 
  group_by(repo_status) %>% 
  summarize(count = n()) %>% 
  kable(col.names = c("Reproductive Status", "Count"))
```



## Task Paradigms

Same as those reported in *Yu et al. (2021)* but in the order of DSP, MAZE, and LOOP. Hormones included are testosterone for men, and estradiol, progesterone, FSH for women. Hormones are taken during time of spatial navigation task, which have been substituted from those data from the time of scan if they were empty.

For measures, we will use the same dependent variables as mentioned in our previous work:

- *DSP*: wayfinding success and solution index

- *MAZE*: accuracy and number of moves

- *LOOP*: position error and degrees traveled


```{r dsp-pe-plot}
#Grid vs weighted general
par(mfrow = c(1,2))
hist(aim1$dsp_path_efficiency_grid, main = "Grid", xlab = "Path Efficiency")
hist(aim1$dsp_path_efficiency_grid_weighted, main = "Weighted", xlab = "Path Efficiency")
t.test(aim1$dsp_path_efficiency_grid, aim1$dsp_path_efficiency_grid_weighted) #no

#separated by men
t.test(aim1_men$dsp_path_efficiency_grid, aim1_men$dsp_path_efficiency_grid_weighted) #no

#women
t.test(aim1_women$dsp_path_efficiency_grid, aim1_women$dsp_path_efficiency_grid_weighted) #no
```


## Analysis

Pearson and Spearman correlations were used. Initially, we did a two-tailed correlation analysis for all hormones, but because we do predict that estradiol and FSH would influence behaviors differently, correlations for women for estradiol (alternative = "greater"), progesterone (alternative = "less"), and FSH (alternative = "less") with one-tailed correlations were also tested.

If the initial correlation was significant, then we would test whether the navigation measure would differ as a function of reproductive status. And we also would use the a FSH to estradiol (FSH:E) ratio to assess whether the relationship holds, using it as an indicator of capturing individual differences in endocrine status.


# Results


## Men: Hormone and Behavior Correlations 


```{r normality-check-men, echo=FALSE, results='hide'}
shapiro.test(aim1_men$loop_pe_rad3_m) #no
shapiro.test(aim1_men$loop_de_rad3_degree) #yes
shapiro.test(aim1_men$loop_de_avg_degree) #no
shapiro.test(aim1_men$loop_ae_rad3_degree) #no
shapiro.test(aim1_men$loop_ae_avg_degree) #no

shapiro.test(aim1_men$maze_accuracy_pct) #yes
shapiro.test(aim1_men$maze_moves) #no
shapiro.test(aim1_men$maze_path_efficiency) #no

shapiro.test(aim1_men$dsp_si_true_pct) #yes
shapiro.test(aim1_men$dsp_success_pct) #no
shapiro.test(aim1_men$dsp_path_efficiency_grid_weighted) #no

shapiro.test(aim1_men$testosterone_spatial_ng_dl) #no
```


Spearman rank correlations were used for LOOP degrees at radius 3.0m, MAZE accuracy, DSP solution index. All other correlations for men were Pearson.

### DSP

```{r dsp-men}
#Filter for men with dsp and testosterone
aim1_men_dsp <- aim1_men %>% 
  dplyr::select(subject_id, dsp_useable, 
                dsp_success_pct, dsp_si_true_pct, 
                dsp_path_efficiency_grid_weighted,
                testosterone_spatial_ng_dl) %>% 
    filter(dsp_useable == "Yes")
           #is.na(testosterone_spatial_ng_dl) != TRUE)
#n=29 without removing missing T
#n=28 for all with T

aim1_men_dsp %>%  #group_by(repo_status) %>% 
  summarize(count = n(),
            avg_succ = mean(dsp_success_pct),
            sd_succ = sd(dsp_success_pct),
            avg_si = mean(dsp_si_true_pct),
            sd_si = sd(dsp_si_true_pct),
            avg_pe = mean(dsp_path_efficiency_grid_weighted),
            sd_pe = sd(dsp_path_efficiency_grid_weighted))

#Normality test
shapiro.test(aim1_men_dsp$dsp_success_pct) #no
shapiro.test(aim1_men_dsp$dsp_si_true_pct) #yes
shapiro.test(aim1_men_dsp$dsp_path_efficiency_grid_weighted) #no
shapiro.test(aim1_men_dsp$testosterone_spatial_ng_dl) #no


########## pearson for wayfinding success
cor.test(aim1_men_dsp$testosterone_spatial_ng_dl,
         aim1_men_dsp$dsp_success_pct,
         conf.level = 0.95,
         method = "pearson")

########## spearman for si
cor.test(aim1_men$testosterone_spatial_ng_dl,
         aim1_men$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")

########## pearson for path efficiency
cor.test(aim1_men$testosterone_spatial_ng_dl,
         aim1_men$dsp_path_efficiency_grid_weighted,
         conf.level = 0.95,
         method = "pearson")
```

```{r dsp-men-si-ci}
#Get CI for rho testosterone
DescTools::SpearmanRho(aim1_men$testosterone_spatial_ng_dl,
                       aim1_men$dsp_si_true_pct,
                       use = "complete.obs",
                       conf.level	= 0.95)
```


Testosterone sample size: Men: *n* = 28

No significant correlations for wayfinding success or solution index.


### MAZE

```{r maze-men}
#Filter for men with maze and testosterone
aim1_men_maze <- aim1_men %>% 
  dplyr::select(subject_id, maze_useable, 
                maze_accuracy_pct, maze_moves, maze_path_efficiency,
                testosterone_spatial_ng_dl) %>% 
  filter(maze_useable == "Yes")
         #is.na(testosterone_spatial_ng_dl) != TRUE)
#n=23
aim1_men_maze %>% #group_by(repo_status) %>% 
  summarize(count = n(),
            mean_succ = mean(maze_accuracy_pct),
            sd_succ = sd(maze_accuracy_pct),
            mean_moves = mean(maze_moves),
            sd_moves = sd(maze_moves),
            mean_pe = mean(maze_path_efficiency),
            sd_pe = sd(maze_path_efficiency))

#Normality test
shapiro.test(aim1_men_maze$maze_accuracy_pct) #yes
shapiro.test(aim1_men_maze$maze_moves) #no
shapiro.test(aim1_men_maze$maze_path_efficiency) #no
shapiro.test(aim1_men_maze$testosterone_spatial_ng_dl) #no


########## spearman for accuracy
cor.test(aim1_men_maze$testosterone_spatial_ng_dl,
         aim1_men_maze$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")

########## Pearson for moves
cor.test(aim1_men_maze$testosterone_spatial_ng_dl,
         aim1_men_maze$maze_moves,
         conf.level = 0.95,
         method = "pearson")

########## Pearson for path efficiency
cor.test(aim1_men_maze$testosterone_spatial_ng_dl,
         aim1_men_maze$maze_path_efficiency,
         conf.level = 0.95,
         method = "pearson")
```

Testosterone sample size: Men: *n* = 23


No significant correlations for accuracy or number of moves.
 
 
### LOOP

```{r loop-men}
#Filter for men with loop and testosterone
aim1_men_loop <- aim1_men %>% 
  dplyr::select(subject_id, loop_useable, 
                loop_pe_rad3_m, 
                loop_de_rad3_degree, loop_de_avg_degree,
                loop_ae_rad3_degree, loop_ae_avg_degree,
                testosterone_spatial_ng_dl) %>% 
  filter(loop_useable == "Yes",
         is.na(loop_pe_rad3_m) != TRUE,
         is.na(loop_de_rad3_degree) != TRUE)
         #is.na(testosterone_spatial_ng_dl) != TRUE)
#n=22, otherwise n=21 for no T for all radii
#n=19, otherwise n=18 for no T and for only 3.0m

aim1_men_loop %>% #group_by(repo_status) %>% 
  summarize(count = n(),
            mean_pe3 = mean(loop_pe_rad3_m, na.rm=T),
            sd_pe3 = sd(loop_pe_rad3_m, na.rm=T),
            mean_de3 = mean(loop_de_rad3_degree, na.rm=T),
            sd_de3 = sd(loop_de_rad3_degree, na.rm=T),
            mean_de_avg = mean(loop_de_avg_degree),
            sd_de_avg = sd(loop_de_avg_degree),
            mean_ae3 = mean(loop_ae_rad3_degree, na.rm=T),
            sd_ae3 = sd(loop_ae_rad3_degree, na.rm=T),
            mean_ae_avg = mean(loop_ae_avg_degree),
            sd_ae_avg = sd(loop_ae_avg_degree))


#Normality test
shapiro.test(aim1_men_loop$loop_pe_rad3_m) #no
shapiro.test(aim1_men_loop$loop_de_rad3_degree) #yes
shapiro.test(aim1_men_loop$loop_de_avg_degree) #no
shapiro.test(aim1_men_loop$loop_ae_rad3_degree) #no
shapiro.test(aim1_men_loop$loop_ae_avg_degree) #no
shapiro.test(aim1_men_loop$testosterone_spatial_ng_dl) #no



########## Pearson for position error 3.0m
cor.test(aim1_men_loop$testosterone_spatial_ng_dl,
         aim1_men_loop$loop_pe_rad3_m,
         conf.level = 0.95,
         method = "pearson")

########## Spearman for degrees traveled 3.0m
cor.test(aim1_men_loop$testosterone_spatial_ng_dl,
         aim1_men_loop$loop_de_rad3_degree,
         conf.level = 0.95,
         method = "spearman")

########## Pearson for degrees traveled avg
cor.test(aim1_men_loop$testosterone_spatial_ng_dl,
         aim1_men_loop$loop_de_avg_degree,
         conf.level = 0.95,
         method = "pearson")

########## Pearson for angular error 3.0m
cor.test(aim1_men_loop$testosterone_spatial_ng_dl,
         aim1_men_loop$loop_de_avg_degree,
         conf.level = 0.95,
         method = "pearson")

########## Pearson for angular error avg
cor.test(aim1_men_loop$testosterone_spatial_ng_dl,
         aim1_men_loop$loop_de_avg_degree,
         conf.level = 0.95,
         method = "pearson")
```

```{r loop-men-de-ci}
#Get CI for rho
DescTools::SpearmanRho(aim1_men_loop$testosterone_spatial_ng_dl,
                       aim1_men_loop$loop_de_rad3_degree,
                       use = "complete.obs",
                       conf.level	= 0.95)
```


```{r loop-men-outlier}
#What if we remove subject 354
men_loop_no354 <- aim1_men_loop %>% filter(!subject_id %in% c(354))
#And subject 320?
men_loop_both <- aim1_men_loop %>% filter(!subject_id %in% c(354, 320))
shapiro.test(men_loop_no354$loop_de_rad3_degree) #no

######## Outlier test for degrees 3.0m ########
test <- grubbs.test(aim1_men_loop$loop_de_rad3_degree)
test #highest value is an outlier (p-value = 0.001135)

test <- grubbs.test(men_loop_no354$loop_de_rad3_degree)
test #next highest is also outlier p-value = 0.006373


#Corr
cor.test(men_loop_no354$testosterone_spatial_ng_dl,
         men_loop_no354$loop_de_rad3_degree,
         conf.level = 0.95,
         method = "pearson") #NOT SIG just 354 removed, p=0.13
cor.test(men_loop_both$testosterone_spatial_ng_dl,
         men_loop_both$loop_de_rad3_degree,
         conf.level = 0.95,
         method = "pearson") #NOT SIG both removed, p=0.156
```

Testosterone sample size: Men: *n* = 18

Degrees traveled at 3.0m was initially negatively correlated with testosterone, but an outlier test revealed that a data point was significantly greater than the rest. After removing the outlier, the relationship disappeared. Thus, there are no significant correlations for position error or degrees traveled.


```{r loop-plot, include=FALSE, echo=FALSE}
ggplot(data = aim1_men_loop, aes(x = testosterone_spatial_ng_dl,
                                 y = loop_de_rad3_degree)) +
  
  #Define scatter, change size and alpha
  geom_point(color = "#00AFBB", size = 3, 
             alpha = 0.6, show.legend = FALSE) +
  
  #Add LM line
  geom_smooth(
              #method = 'loess',
              #formula = 'y ~ x',
              method = lm,
              #formula = y ~ splines::bs(x, 0.5),
              #formula = y ~ poly(x, 2),
              se = FALSE,
              color = "grey50") +
  
  #Change labels
  labs(x = "\nTestosterone (ng/dL)",
       y = expression(atop(paste(bold('Degree ('),
                                 bold(degree),
                                 bold(')')
                                 ))), 
       title = "Degrees Traveled at Radius 3.0m\n",
       #caption = "Smoothing applied using `method = lm` and `formula = y ~ poly(x, 2)`"
       ) +
  
  #Change theme
  theme_minimal() +
  
  #Customize theme
  theme(axis.title = element_text(size = 11, face = "bold"),
        plot.title = element_text(hjust = 0.5),
        axis.title.x = element_text(vjust = 2),
        axis.text = element_text(size= 10)) +
  
  #Add dashed grey line
  geom_hline(yintercept=360, linetype="dashed", color = "grey", size=1)

#save
#ggsave("study1_loop_de_testosterone_lm.png")
```


```{r loop-plot-outlier-rm, include=FALSE, echo=FALSE}
ggplot(data = men_loop_no354, aes(x = testosterone_spatial_ng_dl,
                                 y = loop_de_rad3_degree)) +
  
  #Define scatter, change size and alpha
  geom_point(color = "#00AFBB", size = 3, 
             alpha = 0.6, show.legend = FALSE) +
  
  #Add LM line
  geom_smooth(
              #method = 'loess',
              #formula = 'y ~ x',
              method = lm,
              #formula = y ~ splines::bs(x, 0.5),
              #formula = y ~ poly(x, 2),
              se = FALSE,
              color = "grey50") +
  
  #Change labels
  labs(x = "\nTestosterone (ng/dL)",
       y = expression(atop(paste(bold('Degree ('),
                                 bold(degree),
                                 bold(')')
                                 ))), 
       title = "Degrees Traveled at Radius 3.0m\n",
       #caption = "Smoothing applied using `method = lm` and `formula = y ~ poly(x, 2)`"
       ) +
  
  #Change theme
  theme_minimal() +
  
  #Customize theme
  theme(axis.title = element_text(size = 11, face = "bold"),
        plot.title = element_text(hjust = 0.5),
        axis.title.x = element_text(vjust = 2),
        axis.text = element_text(size= 10)) +
  
  #Add dashed grey line
  geom_hline(yintercept=360, linetype="dashed", color = "grey", size=1)

#save
#ggsave("study1_loop_de_testosterone_rm_lm.png")
```



## Women: Hormone and Behavior Correlations

Hormones bar plot using spatial hormones

```{r repo-stage-age}
#Estradiol
a <- ggplot(data = aim1_women, aes(x = age_spatial_years,
                              y = estradiol_spatial_pg_ml,
                              fill = repo_status, 
                              color = repo_status)) +
  #Add scatter points

  #Define scatter, change size and alpha
  geom_point(aes(color = repo_status),
             size = 3, alpha = 0.6, show.legend = FALSE) +
  
  #Change labels
  labs(x = "Age (years)",
       y = expression(paste(bold("17"),
                            bold(beta),
                            bold("-Estradiol (pg/mL)"))
                      )) +
  
  #Change color of boxplot
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  #Change theme
  theme_classic() +
  
  #Customize theme
  theme(axis.title = element_text(size = 13.5, face = "bold"), 
        axis.text.y = element_text(size = 11),
        axis.text.x = element_text(size= 9)) 



#FSH
b <- ggplot(data = aim1_women, aes(x = age_spatial_years,
                              y = fsh_spatial_miu_ml,
                              fill = repo_status, 
                              color = repo_status)) +
  #Add scatter points

  #Define scatter, change size and alpha
  geom_point(aes(color = repo_status),
             size = 3, alpha = 0.6, show.legend=FALSE) +
  
  #Change labels
  labs(x = "Age (years)",
       y = "FSH (mIU/mL)") +
  
  #Change color of boxplot
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  #Change theme
  theme_classic() +
  
  #Customize theme
  theme(axis.title = element_text(size = 13.5, face = "bold"), 
        axis.text.y = element_text(size = 11),
        axis.text.x = element_text(size= 9)) 


#plot
a+b

```


```{r hormone-summary, include=FALSE}
#Summary of hormones
ehormones_fig <- aim1_women %>% 
  group_by(repo_status) %>% 
  summarize(mean_estradiol = mean(estradiol_spatial_pg_ml, na.rm=T),
            sd_estradiol = sd(estradiol_spatial_pg_ml, na.rm=T),
            n_estradiol = n(),
            se_estradiol = sd(estradiol_spatial_pg_ml)/sqrt(n()), 
            .groups = "keep")
#Number of n for estradiol
ehormones_n <- aim1_women %>% 
  select(repo_status, estradiol_spatial_pg_ml) %>% 
  drop_na(estradiol_spatial_pg_ml) %>% 
  group_by(repo_status) %>% 
  dplyr::summarize(n_estradiol = n())
ehormones_n

phormones_fig <- aim1_women %>% 
  group_by(repo_status) %>% 
  summarize(mean_progesterone = mean(progesterone_spatial_ng_ml, na.rm=T),
            sd_progesterone = sd(progesterone_spatial_ng_ml, na.rm=T),
            n_progesterone = n(),
            se_progesterone = sd(progesterone_spatial_ng_ml)/sqrt(n()), 
            .groups = "keep")
phormones_n <- aim1_women %>% 
  select(repo_status, progesterone_spatial_ng_ml) %>% 
  drop_na(progesterone_spatial_ng_ml) %>% 
  group_by(repo_status) %>% 
  dplyr::summarize(n_progesterone = n())
phormones_n


fhormones_fig <- aim1_women %>% 
  group_by(repo_status) %>% 
  summarize(mean_estradiol = mean(fsh_spatial_miu_ml, na.rm=T),
            sd_estradiol = sd(fsh_spatial_miu_ml, na.rm=T),
            n_estradiol = n(),
            se_estradiol = sd(fsh_spatial_miu_ml)/sqrt(n()), 
            .groups = "keep")
fhormones_n <- aim1_women %>% 
  select(repo_status, fsh_spatial_miu_ml) %>% 
  drop_na(fsh_spatial_miu_ml) %>% 
  group_by(repo_status) %>% 
  dplyr::summarize(n_fsh = n())
fhormones_n
```


```{r hormone-barplot}
#Estradiol plot
a <- ggplot(data = aim1_women, aes(x = repo_status, 
                            y = estradiol_spatial_pg_ml, 
                            fill = repo_status))+
  
  #Define bar plot by mean
  geom_bar(stat="summary", fun= "mean",
           show.legend = FALSE)+ 
  
  #Add SEM errorbar
  stat_summary(geom = "errorbar", 
               fun.data = mean_se,
               width = 0.15, size = 0.7)+
  
  #Change labels
  labs(
       x = "",
       # y = expression(atop(paste(bold("17"),
       #                           bold(beta),
       #                           bold("-Estradiol (pg/mL)")),
       #                     )),
       y = expression(paste(bold("17"),
                                 bold(beta),
                                 bold("-Estradiol (pg/mL)"))),
       tag = "A") +
  
  #Change colors of bars
  #Reverse color scale
  #scale_fill_brewer(palette = "RdPu",direction = -1)+
  
  #Change color of points
  scale_fill_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  #Change theme
  theme_classic() +
  
  #Customize theme
  theme(axis.title = element_text(size = 13.5, face = "bold"), 
        axis.text = element_text(size= 13))

#ggsave("estradiol_bar.png")





#Progesterone plot
b <- ggplot(data = aim1_women, aes(x = repo_status,
                              y = progesterone_spatial_ng_ml,
                              fill = repo_status)) +
  
  #Define bar pplot by mean
  geom_bar(stat = "summary", fun = "mean",
           show.legend = FALSE) +
  
  #Add SEM errorbar
  stat_summary(geom = "errorbar", 
               fun.data = mean_se,
               width = 0.15, size = 0.7)+
  
  #Change labels
  labs(
       x = "",
       y = "Progesterone (ng/mL)\n",
       tag = "B") +
  
  #Change colors of bars
  #Reverse color scale
  #scale_fill_brewer(palette = "RdPu",direction = -1)+
  scale_fill_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  #Change theme
  theme_classic() +
  
  #Customize theme
  theme(axis.title = element_text(size = 13.5, face = "bold"), 
        axis.text = element_text(size= 13))

#ggsave("progesterone_bar.png")


#FSH plot
c <- ggplot(data = aim1_women, aes(x = repo_status, 
                            y = fsh_spatial_miu_ml, 
                            fill = repo_status))+
  
  #Define bar plot by mean
  geom_bar(stat="summary", fun= "mean",
           show.legend = FALSE)+ 
  
  #Add SEM errorbar
  stat_summary(geom = "errorbar", 
               fun.data = mean_se,
               width = 0.15, size = 0.7)+
  
  #Change labels
  labs(
       x = "",
       y = "FSH (mIU/mL)\n",
       tag = "C") +
  
  #Change colors of bars
  #Reverse color scale
  #scale_fill_brewer(palette = "RdPu",direction = -1)+
  scale_fill_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  #Change theme
  theme_classic() +
  
  #Customize theme
  theme(axis.title = element_text(size = 13.5, face = "bold"), 
        axis.text = element_text(size= 13))

#ggsave("fsh_bar.png")


#Show all 3 figs together
a+b+c + theme(axis.title.x=element_blank())
#ggsave("hormones_bar.png")
```


```{r hormone-boxplot, include = TRUE, echo=FALSE}
#Estradiol plot
a <- ggplot(data = aim1_women, aes(x = repo_status, 
                            y = estradiol_spatial_pg_ml, 
                            fill = repo_status))+
  
  #Add ends to whisker
  #stat_boxplot(geom = "errorbar", width = 0.5) + 
  
  #Add scatter points
  #Color by sex, add jitter width, change size and transparency
  #Remove legend for redundancy
  geom_jitter(aes(color = repo_status),
              position = position_jitter(width = .1),
              size = 3, alpha = 0.5,
              show.legend = FALSE) +
  
  #Define boxplot
  #Remove fill color and outlier points
  #Remove legend for redundancy
  geom_boxplot(aes(fill = repo_status), alpha = 0.6,
               outlier.color = NA,
               show.legend = FALSE) +

  #Add mean value for each sex for each site
  #Use point, change size and shape, change color and fill
  stat_summary(fun = mean, 
               geom = "point", 
               shape = 20, 
               size = 4, 
               color ="black", 
               fill="black") +
  
  #Change labels
  labs(
       x = "\nReproductive Status",
       # y = expression(atop(paste(bold("17"),
       #                           bold(beta),
       #                           bold("-Estradiol (pg/mL)")),
       #                     )),
       y = expression(paste(bold("17"),
                                 bold(beta),
                                 bold("-Estradiol (pg/mL)"))),
       tag = "A") +
  

  #Change color of boxplot
  scale_fill_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  #Change color of jitter points
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  #Change theme
  theme_classic() +
  
  #Customize theme
  theme(axis.title = element_text(size = 13.5, face = "bold"), 
        axis.text = element_text(size= 13)) 

#ggsave("estradiol_box.png")


#Progesterone plot
b <- ggplot(data = aim1_women, aes(x = repo_status,
                              y = progesterone_spatial_ng_ml,
                              fill = repo_status)) +
  
   #Add ends to whisker
  #stat_boxplot(geom = "errorbar", width = 0.5) + 

  
  #Add scatter points
  #Color by sex, add jitter width, change size and transparency
  #Remove legend for redundancy
  geom_jitter(aes(color = repo_status),
              position = position_jitter(width = .1),
              size = 3, alpha = 0.5,
              show.legend = FALSE) +
  
  #Define boxplot
  #Remove fill color and outlier points
  #Remove legend for redundancy
  geom_boxplot(aes(fill = repo_status), alpha = 0.6,
               outlier.color = NA,
               show.legend = FALSE) +
  
  #Add mean value for each sex for each site
  #Use point, change size and shape, change color and fill
  stat_summary(fun = mean, 
               geom = "point", 
               shape = 20, 
               size = 4, 
               color ="black", 
               fill="black") +
  
  #Change labels
  labs(
       x = "",
       y = "Progesterone (ng/mL)",
       tag = "B") +
  
    #Change color of boxplot
  scale_fill_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  #Change color of jitter points
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  #Change theme
  theme_classic() +
  
  #Customize theme
  theme(axis.title = element_text(size = 13.5, face = "bold"), 
        axis.text = element_text(size= 13))

#ggsave("progesterone_box.png")


#FSH plot
c <- ggplot(data = aim1_women, aes(x = repo_status, 
                            y = fsh_spatial_miu_ml, 
                            fill = repo_status))+
  
  #Add ends to whisker
  #stat_boxplot(geom = "errorbar", width = 0.5) + 
  
  #Add scatter points
  #Color by sex, add jitter width, change size and transparency
  #Remove legend for redundancy
  geom_jitter(aes(color = repo_status),
              position = position_jitter(width = .1),
              size = 3, alpha = 0.5,
              show.legend = FALSE) +
  
  #Define boxplot
  #Remove fill color and outlier points
  #Remove legend for redundancy
  geom_boxplot(aes(fill = repo_status), alpha = 0.6,
               outlier.color = NA,
               show.legend = FALSE) +
  
  #Add mean value for each sex for each site
  #Use point, change size and shape, change color and fill
  stat_summary(fun = mean, 
               geom = "point", 
               shape = 20, 
               size = 4, 
               color ="black", 
               fill="black") +
  
  #Change labels
  labs(
       x = "\nReproductive Status",
       y = "FSH (mIU/mL)",
       tag = "B") +
  
    #Change color of boxplot
  scale_fill_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  #Change color of jitter points
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  #Change theme
  theme_classic() +
  
  #Customize theme
  theme(axis.title = element_text(size = 13.5, face = "bold"), 
        axis.text = element_text(size= 13))

#ggsave("fsh_box.png")


#Show all 3 figs together
a+c
#ggsave("hormones_box_e_fsh.jpg", dpi = 1200)
```


```{r hormones-anova}
#ANOVA of hormones
hormone_mod <- aov(estradiol_spatial_pg_ml ~ repo_status,
      data = aim1_women)
summary(hormone_mod)
TukeyHSD(hormone_mod)

hormone_mod <- aov(progesterone_spatial_ng_ml ~ repo_status,
      data = aim1_women)
summary(hormone_mod)
TukeyHSD(hormone_mod)

hormone_mod2 <- aov(fsh_spatial_miu_ml ~ repo_status,
      data = aim1_women)
summary(hormone_mod2)
TukeyHSD(hormone_mod2)
```



```{r hormones-kruskal-wallis}
#Kruskal-Wallis rank sum test for non-normal DV of one-way ANOVA

### Estradiol
kruskal.test(estradiol_spatial_pg_ml ~ repo_status,
      data = aim1_women) #p < 0.001
#Check pairwise comparisons using Wilcoxon rank sum test

# Benjamini, Hochberg, and Yekutieli control the false discovery rate, the expected proportion of false discoveries amongst the rejected hypotheses. The false discovery rate is a less stringent condition than the family-wise error rate, so these methods are more powerful than the others.
pairwise.wilcox.test(aim1_women$estradiol_spatial_pg_ml, 
                     aim1_women$repo_status,
                 p.adjust.method = "BH") #pre-peri < 0.01, rest < 0.001

### Progesterone
kruskal.test(progesterone_spatial_ng_ml ~ repo_status,
      data = aim1_women) #p = 0.0039
pairwise.wilcox.test(aim1_women$progesterone_spatial_ng_ml, 
                     aim1_women$repo_status,
                 p.adjust.method = "BH") #pre-peri not sig
#pre-post is 0.0055, peri-post is 0.035


### FSH
kruskal.test(fsh_spatial_miu_ml ~ repo_status,
      data = aim1_women) #p < 0.001
pairwise.wilcox.test(aim1_women$fsh_spatial_miu_ml, 
                     aim1_women$repo_status,
                 p.adjust.method = "BH") # all p < 0.001
```

Kruskal-Wallis rank sum test was used for non-normal comparison between reproductive groups for estradiol, progesterone, and FSH dependent variables. If significant, pairwise comparisons were made using Wilcoxon rank sum test with Benjamini, Hochberg, and Yekutieli *p*-adjustments to control the false discovery rate.

Estradiol is statistically significant between all pairs of reproductive groups (at least *p* < 0.01), as well as FSH (at least *p* < 0.001). Progesterone was different between pre-post (*p* < 0.01) and peri-post (*p* < 0.05).

```{r hormones-eff-size, eval=FALSE}
########## Eta squared for kruskal wallis tests ##########

##### Estradiol #####

#Check test from above
rstatix::kruskal_test(
  data = aim1_women,
  formula = estradiol_spatial_pg_ml ~ repo_status
)

#Effect size
kruskal_effsize(
  data = aim1_women,
  formula = estradiol_spatial_pg_ml ~ repo_status,
  ci = TRUE, #by bootsrap
  conf.level = 0.95,
  ci.type = "perc",
  nboot = 1000
)
#n=81, eff_size = 0.4943322, ci = [0.34,0.63], magnitude = large

#Check pairwise comparison
aim1_women %>% 
  rstatix::wilcox_test(estradiol_spatial_pg_ml ~ repo_status, 
              p.adjust.method = "BH")

#Pairwise Wilcoxon effect size
wilcox_effsize(
  data = aim1_women,
  formula = estradiol_spatial_pg_ml ~ repo_status,
  comparisons = NULL,
  paired = FALSE,
  alternative = "two.sided",
  mu = 0,
  ci = TRUE,
  conf.level = 0.95,
  ci.type = "perc",
  nboot = 1000
)



##### Progesterone #####

#Check test from above
rstatix::kruskal_test(
  data = aim1_women,
  formula = progesterone_spatial_ng_ml ~ repo_status
)

#Effect size
kruskal_effsize(
  data = aim1_women,
  formula = progesterone_spatial_ng_ml ~ repo_status,
  ci = TRUE, #by bootsrap
  conf.level = 0.95,
  ci.type = "perc",
  nboot = 1000
)
#n=81, eff_size = 0.1159669, ci = [0.0064,0.31], magnitude = moderate

#Check pairwise comparison
aim1_women %>% 
  wilcox_test(progesterone_spatial_ng_ml ~ repo_status, 
              p.adjust.method = "BH")

#Pairwise Wilcoxon effect size
wilcox_effsize(
  data = aim1_women,
  formula = progesterone_spatial_ng_ml ~ repo_status,
  comparisons = NULL,
  paired = FALSE,
  alternative = "two.sided",
  mu = 0,
  ci = TRUE,
  conf.level = 0.95,
  ci.type = "perc",
  nboot = 1000
)




##### FSH #####
#Check test from above
rstatix::kruskal_test(
  data = aim1_women,
  formula = fsh_spatial_miu_ml ~ repo_status
)

#Effect size
kruskal_effsize(
  data = aim1_women,
  formula = fsh_spatial_miu_ml ~ repo_status,
  ci = TRUE, #by bootsrap
  conf.level = 0.95,
  ci.type = "perc",
  nboot = 1000
)
#n=81, eff_size = 0.6008231, ci = [0.48,0.71], magnitude = large

#Check pairwise comparison
aim1_women %>% 
  wilcox_test(fsh_spatial_miu_ml ~ repo_status, 
              p.adjust.method = "BH")

#Pairwise Wilcoxon effect size
wilcox_effsize(
  data = aim1_women,
  formula = fsh_spatial_miu_ml ~ repo_status,
  comparisons = NULL,
  paired = FALSE,
  alternative = "two.sided",
  mu = 0,
  ci = TRUE,
  conf.level = 0.95,
  ci.type = "perc",
  nboot = 1000
)




##### Medians #####
aim1_women %>% 
  group_by(repo_status) %>% 
  summarize(med_e = median(estradiol_spatial_pg_ml),
            med_p = median(progesterone_spatial_ng_ml, na.rm=T),
            med_fsh = median(fsh_spatial_miu_ml, na.rm=T))

```



```{r all-normality-check-women}
shapiro.test(aim1_women$loop_pe_rad3_m) #no
shapiro.test(aim1_women$loop_de_rad3_degree) #no
shapiro.test(aim1_women$loop_de_avg_degree) #no
shapiro.test(aim1_women$loop_ae_rad3_degree) #no
shapiro.test(aim1_women$loop_ae_avg_degree) #yes

shapiro.test(aim1_women$maze_accuracy_pct) #yes
shapiro.test(aim1_women$maze_moves) #yes
#shapiro.test(aim1_women$maze_path_efficiency) #tbd

shapiro.test(aim1_women$dsp_si_true_pct) #yes
shapiro.test(aim1_women$dsp_success_pct) #no
shapiro.test(aim1_women$dsp_path_efficiency_grid_weighted) #yes

shapiro.test(aim1_women$estradiol_spatial_pg_ml) #yes
shapiro.test(aim1_women$progesterone_spatial_ng_ml) #yes
shapiro.test(aim1_women$fsh_spatial_miu_ml) #yes

#LOOP dependent variables were not significant as well as DSP wayfinding success, but all other variables were significant, meaning that the normality assumption was violated.
```


Hormones were skewed despite log transformations, thus Spearman rank correlations were applied for all correlations between behavior and the raw hormone values.


### DSP

```{r dsp-women}
#Filter for women with dsp and hormones
aim1_women_dsp <- aim1_women %>% 
  dplyr::select(subject_id, age_spatial_years,
                repo_status, dsp_useable, 
                dsp_success_pct, dsp_si_true_pct, 
                dsp_path_efficiency_grid_weighted,
                estradiol_spatial_pg_ml,
                progesterone_spatial_ng_ml,
                fsh_spatial_miu_ml,
                testosterone_spatial_ng_dl) %>% 
  filter(dsp_useable == "Yes")
#n=47

#Group by repo status
aim1_women_dsp %>%  #group_by(repo_status) %>% 
  summarize(count = n(),
            avg_succ = mean(dsp_success_pct),
            sd_succ = sd(dsp_success_pct),
            avg_si = mean(dsp_si_true_pct),
            sd_si = sd(dsp_si_true_pct),
            avg_pe = mean(dsp_path_efficiency_grid_weighted),
            sd_pe = sd(dsp_path_efficiency_grid_weighted))


#Filter by available hormone
aim1_women_dsp %>% filter(is.na(estradiol_spatial_pg_ml) != TRUE) %>% count() #47
aim1_women_dsp %>% filter(is.na(progesterone_spatial_ng_ml) != TRUE) %>% count() #46
aim1_women_dsp %>% filter(is.na(fsh_spatial_miu_ml) != TRUE) %>% count() #46


#Normality test
shapiro.test(aim1_women_dsp$dsp_success_pct) #no
shapiro.test(aim1_women_dsp$dsp_si_true_pct) #yes
shapiro.test(aim1_women_dsp$dsp_path_efficiency_grid_weighted) #yes
shapiro.test(aim1_women_dsp$estradiol_spatial_pg_ml) #yes
shapiro.test(aim1_women_dsp$progesterone_spatial_ng_ml) #yes
shapiro.test(aim1_women_dsp$fsh_spatial_miu_ml) #yes
shapiro.test(aim1_women_dsp$testosterone_spatial_ng_dl) #yes

#Log
shapiro.test(sqrt(aim1_women_dsp$dsp_si_true_pct)) #yes
shapiro.test(sqrt(aim1_women_dsp$estradiol_spatial_pg_ml)) #yes
shapiro.test(sqrt(aim1_women_dsp$fsh_spatial_miu_ml)) #yes


########## Spearman for wayfinding success

#Estradiol
cor.test(aim1_women_dsp$estradiol_spatial_pg_ml,
         aim1_women_dsp$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")
#Progesterone
cor.test(aim1_women_dsp$progesterone_spatial_ng_ml,
         aim1_women_dsp$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")
#FSH
cor.test(aim1_women_dsp$fsh_spatial_miu_ml,
         aim1_women_dsp$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")

#Testosterone
cor.test


########## Spearman for solution index
#Estradiol
cor.test(aim1_women_dsp$estradiol_spatial_pg_ml,
         aim1_women_dsp$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")
#Progesterone
cor.test(aim1_women_dsp$progesterone_spatial_ng_ml,
         aim1_women_dsp$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")
#FSH
cor.test(aim1_women_dsp$fsh_spatial_miu_ml,
         aim1_women_dsp$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")



######### Pearson for transformed E and FSH
#Estradiol
cor.test(log(aim1_women_dsp$estradiol_spatial_pg_ml),
         log(aim1_women_dsp$dsp_si_true_pct),
         conf.level = 0.95,
         method = "spearman")
#Progesterone
cor.test(aim1_women_dsp$progesterone_spatial_ng_ml,
         aim1_women_dsp$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")
#FSH
cor.test(log(aim1_women_dsp$fsh_spatial_miu_ml),
         aim1_women_dsp$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")




########## Spearman for path efficiency
#Estradiol
cor.test(aim1_women_dsp$estradiol_spatial_pg_ml,
         aim1_women_dsp$dsp_path_efficiency_grid_weighted,
         conf.level = 0.95,
         method = "spearman")
#Progesterone
cor.test(aim1_women_dsp$progesterone_spatial_ng_ml,
         aim1_women_dsp$dsp_path_efficiency_grid_weighted,
         conf.level = 0.95,
         method = "spearman")
#FSH
cor.test(aim1_women_dsp$fsh_spatial_miu_ml,
         aim1_women_dsp$dsp_path_efficiency_grid_weighted,
         conf.level = 0.95,
         method = "spearman")



############# Partial correlation

#Calculate the correlation between estradiol and SI while controlling the variable age
pcor.test(aim1_women_dsp$estradiol_spatial_pg_ml,
          aim1_women_dsp$dsp_si_true_pct,
          aim1_women_dsp$age_spatial_years, 
          method = "spearman") #p-value=0.02876795


#Calculate the correlation between FSH and SI while controlling the variable age
pcor_dsp_fsh <- aim1_women_dsp %>% 
  filter(is.na(fsh_spatial_miu_ml) != TRUE)

pcor.test(pcor_dsp_fsh$fsh_spatial_miu_ml,
          pcor_dsp_fsh$dsp_si_true_pct,
          pcor_dsp_fsh$age_spatial_years, 
          method = "spearman") #p-value=0.414744
```


```{r dsp-women-si-ci}
#Get CI for rho estradiol
DescTools::SpearmanRho(aim1_women_dsp$estradiol_spatial_pg_ml,
                       aim1_women_dsp$dsp_si_true_pct,
                       use = "complete.obs",
                       conf.level	= 0.95)

#Get CI for rho FSH
DescTools::SpearmanRho(aim1_women_dsp$fsh_spatial_miu_ml,
                       aim1_women_dsp$dsp_si_true_pct,
                       use = "complete.obs",
                       conf.level	= 0.95)

#Get CI for rho progesterone
DescTools::SpearmanRho(aim1_women_dsp$progesterone_spatial_ng_ml,
                       aim1_women_dsp$dsp_si_true_pct,
                       use = "complete.obs",
                       conf.level	= 0.95)
```



```{r dsp-anova-kruskal}
#ANOVA for DSP solution index as a function of repo stage
si_mod <- aov(dsp_si_true_pct ~ repo_status,
              data = aim1_women_dsp)
summary(si_mod)


#Kruskal-Wallis test
kruskal.test(dsp_si_true_pct ~ repo_status,
              data = aim1_women_dsp) #not significant, p=0.078


#Check test from above
rstatix::kruskal_test(
  data = aim1_women_dsp,
  formula = dsp_si_true_pct ~ repo_status
)

#Effect size
kruskal_effsize(
  data = aim1_women_dsp,
  formula = dsp_si_true_pct ~ repo_status,
  ci = TRUE, #by bootsrap
  conf.level = 0.95,
  ci.type = "perc",
  nboot = 1000
)
#n=47, eff_size = 0.07042751	, ci = [-0.04,0.3], magnitude = moderate


#Median values of DSP solution index by repo groups
aim1_women_dsp %>% 
  group_by(repo_status) %>% 
  summarize(med_si = median(dsp_si_true_pct))
```


Estradiol sample size: Women: *n* = 47 (Pre: *n* = 19; Peri: *n* = 15; Post: *n* = 13)

Progesterone and FSH sample size: *n* = 46 (Pre: *n* = 19; Peri: *n* = 14; Post: *n* = 13)

With two-tailed test, there was no significant correlation for wayfinding success, but significant positive correlation for solution index for estradiol ($\rho$ = 0.421, *p* < 0.01) and negative marginal correlation for FSH ($\rho$ = -0.281, *p* = 0.058).

Kruskal-Wallis test of DSP solution index by reproductive status for women was not significant.


```{r dsp-women-one-tail}
########## Spearman for wayfinding success

#Estradiol
cor.test(aim1_women_dsp$estradiol_spatial_pg_ml,
         aim1_women_dsp$dsp_success_pct,
         conf.level = 0.95,
         alternative = "greater",
         method = "spearman")
#Progesterone
cor.test(aim1_women_dsp$progesterone_spatial_ng_ml,
         aim1_women_dsp$dsp_success_pct,
         conf.level = 0.95,
         alternative = "less",
         method = "spearman")
#FSH
cor.test(aim1_women_dsp$fsh_spatial_miu_ml,
         aim1_women_dsp$dsp_success_pct,
         conf.level = 0.95,
         alternative = "less",
         method = "spearman")


########## Spearman for solution index
#Estradiol
cor.test(aim1_women_dsp$estradiol_spatial_pg_ml,
         aim1_women_dsp$dsp_si_true_pct,
         conf.level = 0.95,
         alternative = "greater",
         method = "spearman") #p=0.001601

#Progesterone
cor.test(aim1_women_dsp$progesterone_spatial_ng_ml,
         aim1_women_dsp$dsp_si_true_pct,
         conf.level = 0.95,
         alternative = "less",
         method = "spearman")
#FSH
cor.test(aim1_women_dsp$fsh_spatial_miu_ml,
         aim1_women_dsp$dsp_si_true_pct,
         conf.level = 0.95,
         alternative = "less",
         method = "spearman") #p=0.02903

```

With the one-tailed test, there was also no relationship for wayfinding success, but solution index remained positively correlated with estradiol ($\rho$ = 0.421, *p* < 0.01) and was significantly negatively correlated with FSH ($\rho$ = -0.281, *p* < 0.05).



```{r dsp-plot, include = TRUE, echo=FALSE}
#E and FSH plot with SI
#n=46 FSH, n=47 estradiol
aim1_women_dsp <- aim1_women %>% 
  dplyr::select(dsp_useable, dsp_success_pct, dsp_si_true_pct,
                repo_status,
                estradiol_spatial_pg_ml,
                progesterone_spatial_ng_ml,
                fsh_spatial_miu_ml) %>% 
  filter(dsp_useable == "Yes")

a <- ggplot(data = aim1_women_dsp, aes(x = estradiol_spatial_pg_ml,
                                        y = dsp_si_true_pct)) +
  
  #Define scatter, change size and alpha
  geom_point(aes(color = repo_status),
             size = 3, alpha = 0.6, show.legend = FALSE) +
  
  #Add LM line
  geom_smooth(
    method = lm, 
    #formula = y ~ poly(x, 2),
    #method = "gam", formula = y ~ s(x, bs = "cs"),
              se = FALSE,
              color = "grey50") +
  
  #Change labels
  labs(x = expression(paste(bold("17"),
                            bold(beta),
                            bold("-Estradiol (pg/mL)"))
                      ),
       y = "Solution Index (%)\n",
       color = "Reproductive Status",
       tag = "C") +
  
  #Change color of points
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  theme_minimal() +
  
  #Customize theme
  theme(axis.title = element_text(size = 13.5, face = "bold"), 
        axis.title.x = element_text(vjust = -0.5),
        axis.text = element_text(size= 13))



b <- ggplot(data = aim1_women_dsp, aes(x = fsh_spatial_miu_ml,
                            y = dsp_si_true_pct,
                            color = repo_status)) +
  
  #Define scatter, change size and alpha
  geom_point(aes(color = repo_status),
             size = 3, alpha = 0.6) +
  
  #Add LM line
  geom_smooth(
    method = lm, 
    #formula = y ~ poly(x, 2),
    #method = "gam", formula = y ~ s(x, bs = "cs"),
              se = FALSE,
              color = "grey50") +
  
  #Change labels
  labs(x = "\nFSH (mIU/mL)",
       y = "Solution Index (%)\n",
       color = "Reproductive Status",
       tag = "D"
       #caption = "Smoothing applied using `method = lm` and `formula = y ~ poly(x, 2)`"
       ) +
  
  #Change color of points
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  theme_minimal() +
  
  #Customize theme
  theme(axis.title = element_text(size = 13.5, face = "bold"),
        axis.title.x = element_text(vjust = 2),
        axis.text = element_text(size= 13),
        
        #Legend
        #legend.title = element_text(face = "bold"),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 11),
        legend.position = "top"
        
        )


#Combine
combined <- a + b & theme(legend.position = "bottom")
combined + plot_layout(guides = "collect")

#save
#ggsave("study1_dsp_si_estradiol_fsh_lm.jpg", dpi = 1200)
```


```{r dsp-plot-emily, include=FALSE}
a <- ggscatter(aim1_women_dsp, 
          x = "fsh_spatial_miu_ml", y = "dsp_si_true_pct",
          add = "reg.line",
          add.params = list(color = "blue", fill = "lightgray"), # Customize reg. line
          cor.coef = TRUE, # Add correlation coefficient. see ?stat_cor
          conf.int = TRUE, 
          cor.method = "spearman",
          cor.coeff.args = list(label.sep = "\n"),
          xlab = "FSH (mIU/mL)", ylab = "Solution Index") 

b <- ggscatter(aim1_women_dsp, 
          x = "estradiol_spatial_pg_ml", y = "dsp_si_true_pct",
          add = "reg.line",
          add.params = list(color = "blue", fill = "lightgray"), # Customize reg. line
          cor.coef = TRUE, # Add correlation coefficient. see ?stat_cor
          conf.int = TRUE, 
          cor.method = "spearman",
          cor.coeff.args = list(label.sep = "\n"),
          xlab = "Estradiol (pg/mL)", ylab = "Solution Index") 

a+b

#ggsave("dsp_si_for_emily.png")
```


#### DSP Solution Index Sex Difference

Since we see a relationship between solution index and hormones in women but not in men, we want to know what are the proportion of place vs response stratgies between women and men.

```{r ttest-dsp-si, include=FALSE}
##### Is there a difference in solution index? #####

#After checking differences in table for men vs women
#both non-normal so use Wilcoxon rank sum
wilcox.test(aim1_men_dsp$dsp_si_true_pct,
            aim1_women_dsp$dsp_si_true_pct) #p=0.135
median(aim1_men_dsp$dsp_si_true_pct) #0.1818182
median(aim1_women_dsp$dsp_si_true_pct) #0.25



##### Proportion of place strategies overall #####

dsp_df <- read_csv(here("data", "dsp_midlife_behavior_variables.csv")) %>% 
  clean_names() %>% 
  mutate(subject_number = as.double(subject_number))
  #rename(subject_id = subject_number) 

#Merge aim1 and dsp dataframes by the subject_id
dsp_merge_m <- full_join(aim1_men_dsp, dsp_df, by = ("subject_id" = "subject_number")) %>% 
  filter(dsp_useable == "Yes")
#dsp_merge_m <- left_join(aim1_men_dsp, dsp_df, by = c("subject_id" = "subject_id"))
dsp_merge_f <- full_join(aim1_women_dsp, dsp_df, by = ("subject_id" = "subject_number")) %>%  
  filter (dsp_useable == "Yes")
#dsp_merge_f <- left_join(aim1_women_dsp, dsp_df, by = c("subject_id" = "subject_id"))


#Get men's proportion of response and place strategies
dsp_merge_m <- dsp_merge_m %>% 
  mutate(place_prop = shortcuts_total/success,
         response_prop = learned_total/success)
#Show the table for men
tab_m <- dsp_merge_m %>% group_by(sex) %>% 
  mutate(place_prop = shortcuts_total/success,
         response_prop = learned_total/success) %>% 
  dplyr::summarize(mean_place = mean(place_prop),
                   sd_place = sd(place_prop),
                   mean_response = mean(response_prop),
                   sd_response = sd(response_prop),
                   mean_ratio = mean_place/mean_response)


#Get women's proportion of response and place strategies
dsp_merge_f <- dsp_merge_f %>% 
  mutate(place_prop = shortcuts_total/success,
         response_prop = learned_total/success)
#Show the table for women
tab_f <- dsp_merge_f %>% group_by(sex) %>% 
    mutate(place_prop = shortcuts_total/success,
         response_prop = learned_total/success) %>% 
  dplyr::summarize(mean_place = mean(place_prop),
                   sd_place = sd(place_prop),
                   mean_response = mean(response_prop),
                   sd_response = sd(response_prop),
                   mean_ratio = mean_place/mean_response)

#Show the table for reproductive groups
tab_repo <- dsp_merge_f %>% group_by(repo_status) %>% 
    mutate(place_prop = shortcuts_total/success,
         response_prop = learned_total/success) %>% 
  dplyr::summarize(mean_place = mean(place_prop),
                   sd_place = sd(place_prop),
                   mean_response = mean(response_prop),
                   sd_response = sd(response_prop),
                   mean_ratio = mean_place/mean_response)

#Stack and change column names
tab_all <- rbind(tab_m, tab_f)
colnames(tab_repo)[1] <- "sex"
tab_all_final <- rbind(tab_all, tab_repo)

colnames(tab_all_final)[1] <- "Group"
tab_all_final[1, "sex"] <- "Men"
tab_all_final[2, "sex"] <- "Women"

#Show final table
tab_all_final %>% 
  kable(col.names = c("Group", "Mean", "SD", "Mean", "SD", "Mean Ratio"),
        caption = "Mean and SD for proportion of place and response strategies used in the DSP task. Mean ratio is average proportion of place to average response stratgies used.",
        align = rep("c", 6),
        digits = 3) %>% 
  kable_styling("striped", full_width = FALSE,
                position = "center", 
                font_size = 12) %>%
  add_header_above(c(" " = 1, "Place" = 2, 
                     "Response" = 2, " " = 1))



##### Is there a sex difference in proportion of place strategy used? #####

#Normality check for proportion place in men vs women
shapiro.test(dsp_merge_m$place_prop) #no
shapiro.test(dsp_merge_f$place_prop) #yes

#Mann Whitney U results = Not sig, p=0.7, W=718
wilcox.test(dsp_merge_m$place_prop, 
            dsp_merge_f$place_prop,
            paired=FALSE, exact=FALSE, conf.int=TRUE)
median(dsp_merge_m$place_prop) #0.273
median(dsp_merge_f$place_prop) #0.267


##### Is there a sex difference in proportion of response strategy used? #####

#Normality check for proportion place in men vs women
shapiro.test(dsp_merge_m$response_prop) #no
shapiro.test(dsp_merge_f$response_prop) #no

#T-test results = Not significant, p=0.7672, t= -0.29735
t.test(dsp_merge_m$response_prop, 
      dsp_merge_f$response_prop, paired = FALSE, conf.level = 0.95)
```


We can also plot the data to see what the table looks like visually:

```{r dsp-plot-table}
#Plot proportion place strategies used by groups
dsp_merge_m2 <- dsp_merge_m %>% 
  select(subject_id, place_prop, response_prop) %>% 
  mutate(group = "Men")

dsp_merge_f2 <- dsp_merge_f %>% 
  select(subject_id, place_prop, response_prop) %>% 
  mutate(group = "Women")

dsp_merge_repo <- dsp_merge_f %>% 
  select(subject_id, place_prop, response_prop, repo_status) %>% 
  rename(group = repo_status)

#Stack dataframes
dsp_merge_all <- rbind(dsp_merge_m2, dsp_merge_f2, dsp_merge_repo) %>% 
  #Reorder group
  mutate(group = fct_relevel(group, 
                             c("Men", "Women", 
                               "Pre", "Peri", "Post")))


##############  Plot
a <- ggplot(data = dsp_merge_all, aes(x = group,
                                 y = place_prop,
                                 fill = group, color = group)) +
  #Add scatter points
  #Color by group, add jitter width, change size and transparency
  #Remove legend for redundancy
  geom_jitter(aes(color = group),
              position = position_jitter(width = .1),
              size = 3, alpha = 0.5,
              show.legend = FALSE) +
  
  #Define boxplot
  #Remove fill color and outlier points
  #Remove legend for redundancy
  geom_boxplot(aes(fill = group), alpha = 0.6,
               outlier.color = NA,
               show.legend = FALSE) +

  #Add mean value for each sex for each site
  #Use point, change size and shape, change color and fill
  stat_summary(fun = mean, 
               geom = "point", 
               shape = 20, 
               size = 4, 
               color ="black", 
               fill="black") +
  
  #Change labels
  labs(x = "Group",
       y = "Place Strategies (%)\n",
       tag = "A") +
  
  #Change color of boxplot
  scale_fill_manual(values = c("steelblue3", "mediumpurple1", 
                               "cadetblue4", "mediumvioletred", "darkorange")) +
  
  #Change color of jitter points
  scale_color_manual(values = c("steelblue3", "mediumpurple1",
                                "cadetblue4", "mediumvioletred", "darkorange")) +
  
  #Change theme
  theme_classic() +
  
  #Customize theme
  theme(axis.title = element_text(size = 13.5, face = "bold"), 
        axis.text.y = element_text(size = 11),
        axis.text.x = element_text(size= 9)) 




b <- ggplot(data = dsp_merge_all, aes(x = group,
                                 y = response_prop,
                                 fill = group, color = group)) +
  #Add scatter points
  #Color by group, add jitter width, change size and transparency
  #Remove legend for redundancy
  geom_jitter(aes(color = group),
              position = position_jitter(width = .1),
              size = 3, alpha = 0.5,
              show.legend = FALSE) +
  
  #Define boxplot
  #Remove fill color and outlier points
  #Remove legend for redundancy
  geom_boxplot(aes(fill = group), alpha = 0.6,
               outlier.color = NA,
               show.legend = FALSE) +

  #Add mean value for each sex for each site
  #Use point, change size and shape, change color and fill
  stat_summary(fun = mean, 
               geom = "point", 
               shape = 20, 
               size = 4, 
               color ="black", 
               fill="black") +
  
  #Change labels
  labs(x = "Group",
       y = "Response Strategies (%)\n",
       tag = "B") +
  
  #Change color of boxplot
  scale_fill_manual(values = c("steelblue3", "mediumpurple1", 
                               "cadetblue4", "mediumvioletred", "darkorange")) +
  
  #Change color of jitter points
  scale_color_manual(values = c("steelblue3", "mediumpurple1",
                                "cadetblue4", "mediumvioletred", "darkorange")) +
  
  #Change theme
  theme_classic() +
  
  #Customize theme
  theme(axis.title = element_text(size = 13.5, face = "bold"), 
        axis.text.y = element_text(size = 11),
        axis.text.x = element_text(size= 9)) 

#Combine and show
a+b
```

There were no differences between proportion of place strategies used between women and men (*p* = 0.7), and there was also no sex difference in proportion of response strategies used (*p* = 0.77).

If we look at the data by reproductive status, the pres actually have highest mean proportion of place strategies used (more than men), and they also have the lowest proportion of response strategies used.


#### FSH:E Ratio

```{r dsp-ratio, results='hide'}
#Create new column with ratio
aim1_women <- aim1_women %>% 
  mutate(e_fsh_ratio = estradiol_spatial_pg_ml/fsh_spatial_miu_ml,
         fsh_e_ratio = fsh_spatial_miu_ml/estradiol_spatial_pg_ml)

#Filter for DSP
aim1_women_dsp_ratio <- aim1_women %>% 
  filter(dsp_useable == "Yes") %>% 
  select(subject_id, repo_status, e_fsh_ratio, fsh_e_ratio, 
         estradiol_spatial_pg_ml, fsh_spatial_miu_ml,
         dsp_success_pct, dsp_si_true_pct)

#Check distribution of E:FSH ratio (probably not normal)
shapiro.test(aim1_women_dsp_ratio$e_fsh_ratio) #yes
shapiro.test(log(aim1_women$e_fsh_ratio)) #yes

shapiro.test(aim1_women_dsp_ratio$fsh_e_ratio) #yes
shapiro.test(log(aim1_women$fsh_e_ratio)) #yes

#All correlations need to be Spearman rank


###### Check remove outlier for FSH:E in SI
aim1_dsp_ratio_rm <- aim1_women_dsp_ratio %>% 
  filter(subject_id != "327") #n=46
shapiro.test(aim1_dsp_ratio_rm$fsh_e_ratio) #yes

cor.test(aim1_dsp_ratio_rm$fsh_e_ratio,
         aim1_dsp_ratio_rm$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman") #still significant, p=0.00972

#Get CI for rho
DescTools::SpearmanRho(aim1_dsp_ratio_rm$fsh_e_ratio,
                       aim1_dsp_ratio_rm$dsp_si_true_pct,
                       use = "complete.obs",
                       conf.level	= 0.95)
```


When we use a FSH:E ratio for DSP solution index, the correlation was significant. The hormone ratio was negatively correlated with DSP solution index ($\rho$ = -0.381, *p* < 0.01).


```{r dsp-plot-ratio, include=TRUE}
#Plot E:FSH ratio and solution index
# ggplot(data = aim1_dsp_ratio_rm, aes(x = as.numeric(e_fsh_ratio),
#                             y = dsp_si_true_pct,
#                             #text = subject_id
#                             )) +
#   
#   #Define scatter, change size and alpha
#   geom_point(aes(color = repo_status),
#              size = 3, alpha = 0.6) +
#   
#   #Add LM line
#   geom_smooth(method = "lm", se = FALSE,
#               color = "grey50") +
#   
#   #Change labels
#   labs(x = "\nEstradiol to FSH Ratio",
#        y = "Solution Index (%)",
#        color = "Reproductive Status") +
#   
#   #Change color of points
#   scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
#   
#   theme_minimal() +
#   
#   #Customize theme
#   theme(axis.title = element_text(size = 11, face = "bold"),
#         axis.title.x = element_text(vjust = 2),
#         axis.text = element_text(size= 10),
#         
#         #Legend
#         #legend.title = element_text(face = "bold"),
#         legend.position = "top")




#Plot FSH:E ratio and solution index
ggplot(data = aim1_dsp_ratio_rm, aes(x = as.numeric(fsh_e_ratio),
                            y = dsp_si_true_pct,
                            #text = subject_id
                            )) +
  
  #Define scatter, change size and alpha
  geom_point(aes(color = repo_status),
             size = 3, alpha = 0.6) +
  
  #Add LM line
  geom_smooth(method = "lm", se = FALSE, color = "grey50") +
  
  #Change labels
  labs(x = "\nFSH:E Ratio",
       y = "Solution Index (%)\n",
       color = "Reproductive Status") +
  
  #Change color of points
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  theme_minimal() +
  
  #Customize theme
  theme(axis.title = element_text(size = 11, face = "bold"),
        axis.title.x = element_text(vjust = 2),
        axis.text = element_text(size= 10),
        
        #Legend
        #legend.title = element_text(face = "bold"),
        legend.position = "top",
        
        #Square shaped
        aspect.ratio=1)

ggsave("f_e_ratio.png")
```


The FSH:E ratio and DSP solution index plot has already been removed for one outlier (post-menopause), so *n* = 45 for this correlation analysis and plot.


```{r dsp-ratio-correlations-one-tail}
#One-tailed t-test for E and FSH for solution index
# cor.test(aim1_dsp_ratio_rm$e_fsh_ratio,
#          aim1_dsp_ratio_rm$dsp_si_true_pct,
#          conf.level = 0.95, alternative = "greater",
#          method = "spearman") #p=0.00486, rho=0.3814803 

cor.test(aim1_dsp_ratio_rm$fsh_e_ratio,
         aim1_dsp_ratio_rm$dsp_si_true_pct,
         conf.level = 0.95, alternative = "less",
         method = "spearman") #p=0.00486, rho = -0.3814803 


#Confidence intervals
# DescTools::SpearmanRho(aim1_dsp_ratio_rm$e_fsh_ratio,
#                        aim1_dsp_ratio_rm$dsp_si_true_pct,
#                        use = "complete.obs"
#                        conf.level	= 0.95)

DescTools::SpearmanRho(aim1_dsp_ratio_rm$fsh_e_ratio,
                       aim1_dsp_ratio_rm$dsp_si_true_pct,
                       use = "complete.obs",
                       conf.level	= 0.95)
```

Even if we restrict the analysis to a one-tailed test, the correlation between FSH:E ratio and DSP solution index remained significant (*p* < 0.01).


### MAZE

```{r maze-women}
#Filter for women with maze and hormones
aim1_women_maze <- aim1_women %>% 
  dplyr::select(subject_id, repo_status, maze_useable, 
                maze_accuracy_pct, maze_moves, maze_path_efficiency,
                estradiol_spatial_pg_ml,
                progesterone_spatial_ng_ml,
                fsh_spatial_miu_ml) %>% 
  filter(maze_useable == "Yes")
#n=64

#Group by repo status
aim1_women_maze %>% #group_by(repo_status) %>% 
  summarize(count = n(),
            mean_succ = mean(maze_accuracy_pct),
            sd_succ = sd(maze_accuracy_pct),
            mean_moves = mean(maze_moves),
            sd_moves = sd(maze_moves),
            mean_pe = mean(maze_path_efficiency),
            sd_pe = sd(maze_path_efficiency))


#Filter by available hormone
aim1_women_maze %>% filter(is.na(estradiol_spatial_pg_ml) != TRUE) %>% count() #64
aim1_women_maze %>% filter(is.na(progesterone_spatial_ng_ml) != TRUE) %>% count() #61
aim1_women_maze %>% filter(is.na(fsh_spatial_miu_ml) != TRUE) %>% count() #61

#Normality test
shapiro.test(aim1_women_maze$maze_accuracy_pct) #yes
shapiro.test(aim1_women_maze$maze_moves) #yes
shapiro.test(aim1_women_maze$maze_path_efficiency) #yes
shapiro.test(aim1_women_maze$estradiol_spatial_pg_ml) #yes
shapiro.test(aim1_women_maze$progesterone_spatial_ng_ml) #yes
shapiro.test(aim1_women_maze$fsh_spatial_miu_ml) #yes


##### Men vs women MOVES
#p=0.09
wilcox.test(aim1_men_maze$maze_moves, 
            aim1_women_maze$maze_moves,
            paired=FALSE, exact=FALSE, conf.int=TRUE)
median(aim1_men_maze$maze_moves) #275
median(aim1_women_maze$maze_moves) #268


########## Spearman for wayfinding success
#Estradiol
cor.test(aim1_women_maze$estradiol_spatial_pg_ml,
         aim1_women_maze$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")
#Progesterone
cor.test(aim1_women_maze$progesterone_spatial_ng_ml,
         aim1_women_maze$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")
#FSH
cor.test(aim1_women_maze$fsh_spatial_miu_ml,
         aim1_women_maze$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for moves

#Estradiol
cor.test(aim1_women_maze$estradiol_spatial_pg_ml,
         aim1_women_maze$maze_moves,
         conf.level = 0.95,
         method = "spearman")
#Progesterone
cor.test(aim1_women_maze$progesterone_spatial_ng_ml,
         aim1_women_maze$maze_moves,
         conf.level = 0.95,
         method = "spearman")
#FSH
cor.test(aim1_women_maze$fsh_spatial_miu_ml,
         aim1_women_maze$maze_moves,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for path efficiency

#Estradiol
cor.test(aim1_women_maze$estradiol_spatial_pg_ml,
         aim1_women_maze$maze_path_efficiency,
         conf.level = 0.95,
         method = "spearman")
#Progesterone
cor.test(aim1_women_maze$progesterone_spatial_ng_ml,
         aim1_women_maze$maze_path_efficiency,
         conf.level = 0.95,
         method = "spearman")
#FSH
cor.test(aim1_women_maze$fsh_spatial_miu_ml,
         aim1_women_maze$maze_path_efficiency,
         conf.level = 0.95,
         method = "spearman")
```


```{r maze-women-one-tail}
########## Spearman for wayfinding success
#Estradiol
cor.test(aim1_women_maze$estradiol_spatial_pg_ml,
         aim1_women_maze$maze_accuracy_pct,
         alternative = "greater",
         conf.level = 0.95,
         method = "spearman")

#Progesterone
cor.test(aim1_women_maze$progesterone_spatial_ng_ml,
         aim1_women_maze$maze_accuracy_pct,
         alternative = "less",
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(aim1_women_maze$fsh_spatial_miu_ml,
         aim1_women_maze$maze_accuracy_pct,
         conf.level = 0.95,
         alternative = "less",
         method = "spearman")


########## Spearman for moves

#Estradiol
cor.test(aim1_women_maze$estradiol_spatial_pg_ml,
         aim1_women_maze$maze_moves,
         alternative = "greater",
         conf.level = 0.95,
         method = "spearman")


#Progesterone
cor.test(aim1_women_maze$progesterone_spatial_ng_ml,
         aim1_women_maze$maze_moves,
         alternative = "less",
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(aim1_women_maze$fsh_spatial_miu_ml,
         aim1_women_maze$maze_moves,
         conf.level = 0.95,
         alternative = "less",
         method = "spearman")
```


Estradiol sample size: Women: *n* = 64 (Pre: *n* = 24; Peri: *n* = 21; Post: *n* = 19)

Progesterone and FSH sample size: *n* = 61 (Pre: *n* = 24; Peri: *n* = 21; Post: *n* = 16)

No correlations for accuracy or number of moves using two-tailed or one-tailed test (estradiol = "greater"; progesterone and FSH = "less").



### LOOP


```{r loop-women}
#Filter for women with loop and hormones
aim1_women_loop <- aim1_women %>% 
  dplyr::select(subject_id, repo_status, loop_useable, 
                loop_pe_rad3_m, 
                loop_de_rad3_degree, loop_de_avg_degree,
                loop_ae_rad3_degree, loop_ae_avg_degree,
                estradiol_spatial_pg_ml,
                progesterone_spatial_ng_ml,
                fsh_spatial_miu_ml) %>% 
  filter(loop_useable == "Yes",
         is.na(loop_pe_rad3_m) != TRUE,
         is.na(loop_de_rad3_degree) != TRUE)
#n=32, but 1 without 3.0m so n=31

#N by repo status
aim1_women_loop %>% #group_by(repo_status) %>% 
  summarize(count = n(),
            mean_pe3 = mean(loop_pe_rad3_m, na.rm=T),
            sd_pe3 = sd(loop_pe_rad3_m, na.rm=T),
            mean_de3 = mean(loop_de_rad3_degree, na.rm=T),
            sd_de3 = sd(loop_de_rad3_degree, na.rm=T),
            mean_de_avg = mean(loop_de_avg_degree),
            sd_de_avg = sd(loop_de_avg_degree),
            mean_ae3 = mean(loop_ae_rad3_degree, na.rm=T),
            sd_ae3 = sd(loop_ae_rad3_degree, na.rm=T),
            mean_ae_avg = mean(loop_ae_avg_degree),
            sd_ae_avg = sd(loop_ae_avg_degree))


#Filter by available hormone
aim1_women_loop %>% filter(is.na(estradiol_spatial_pg_ml) != TRUE) %>% group_by(repo_status) %>% count() #32
aim1_women_loop %>% filter(is.na(progesterone_spatial_ng_ml) != TRUE) %>% group_by(repo_status) %>%  count() #26
aim1_women_loop %>% filter(is.na(fsh_spatial_miu_ml) != TRUE) %>% group_by(repo_status) %>% count() #26

#Normality test
shapiro.test(aim1_women_loop$loop_pe_rad3_m) #no
shapiro.test(aim1_women_loop$loop_de_rad3_degree) #no
shapiro.test(aim1_women_loop$loop_de_avg_degree) #no
shapiro.test(aim1_women_loop$loop_ae_rad3_degree) #no
shapiro.test(aim1_women_loop$loop_ae_avg_degree) #yes
shapiro.test(aim1_women_loop$estradiol_spatial_pg_ml) #yes
shapiro.test(aim1_women_loop$progesterone_spatial_ng_ml) #yes
shapiro.test(aim1_women_loop$fsh_spatial_miu_ml) #yes


########## Spearman for position error 3.0m
cor.test(aim1_women_loop$estradiol_spatial_pg_ml,
         aim1_women_loop$loop_pe_rad3_m,
         conf.level = 0.95,
         method = "spearman")
cor.test(aim1_women_loop$progesterone_spatial_ng_ml,
         aim1_women_loop$loop_pe_rad3_m,
         conf.level = 0.95,
         method = "spearman")
cor.test(aim1_women_loop$fsh_spatial_miu_ml,
         aim1_women_loop$loop_pe_rad3_m,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for degrees traveled 3.0m
cor.test(aim1_women_loop$estradiol_spatial_pg_ml,
         aim1_women_loop$loop_de_rad3_degree,
         conf.level = 0.95,
         method = "spearman")
cor.test(aim1_women_loop$progesterone_spatial_ng_ml,
         aim1_women_loop$loop_de_rad3_degree,
         conf.level = 0.95,
         method = "spearman")
cor.test(aim1_women_loop$fsh_spatial_miu_ml,
         aim1_women_loop$loop_de_rad3_degree,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for degrees traveled avg
cor.test(aim1_women_loop$estradiol_spatial_pg_ml,
         aim1_women_loop$loop_de_avg_degree,
         conf.level = 0.95,
         method = "spearman")
cor.test(aim1_women_loop$progesterone_spatial_ng_ml,
         aim1_women_loop$loop_de_avg_degree,
         conf.level = 0.95,
         method = "spearman")
cor.test(aim1_women_loop$fsh_spatial_miu_ml,
         aim1_women_loop$loop_de_avg_degree,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for angular error 3.0m
cor.test(aim1_women_loop$estradiol_spatial_pg_ml,
         aim1_women_loop$loop_ae_rad3_degree,
         conf.level = 0.95,
         method = "spearman")
cor.test(aim1_women_loop$progesterone_spatial_ng_ml,
         aim1_women_loop$loop_ae_rad3_degree,
         conf.level = 0.95,
         method = "spearman")
cor.test(aim1_women_loop$fsh_spatial_miu_ml,
         aim1_women_loop$loop_ae_rad3_degree,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for angular error avg
cor.test(aim1_women_loop$estradiol_spatial_pg_ml,
         aim1_women_loop$loop_ae_avg_degree,
         conf.level = 0.95,
         method = "spearman")
cor.test(aim1_women_loop$progesterone_spatial_ng_ml,
         aim1_women_loop$loop_ae_avg_degree,
         conf.level = 0.95,
         method = "spearman")
cor.test(aim1_women_loop$fsh_spatial_miu_ml,
         aim1_women_loop$loop_ae_avg_degree,
         conf.level = 0.95,
         method = "spearman")
```

```{r loop-women-one-tail}
########## Spearman for position error 3.0m
cor.test(aim1_women_loop$estradiol_spatial_pg_ml,
         aim1_women_loop$loop_pe_rad3_m,
         alternative = "greater",
         conf.level = 0.95,
         method = "spearman")
cor.test(aim1_women_loop$progesterone_spatial_ng_ml,
         aim1_women_loop$loop_pe_rad3_m,
         alternative = "less",
         conf.level = 0.95,
         method = "spearman")
cor.test(aim1_women_loop$fsh_spatial_miu_ml,
         aim1_women_loop$loop_pe_rad3_m,
         alternative = "less",
         conf.level = 0.95,
         method = "spearman")


########## Spearman for degrees traveled 3.0m
cor.test(aim1_women_loop$estradiol_spatial_pg_ml,
         aim1_women_loop$loop_de_rad3_degree,
         conf.level = 0.95,
         alternative = "greater",
         method = "spearman")
cor.test(aim1_women_loop$progesterone_spatial_ng_ml,
         aim1_women_loop$loop_de_rad3_degree,
         alternative = "less",
         conf.level = 0.95,
         method = "spearman")
cor.test(aim1_women_loop$fsh_spatial_miu_ml,
         aim1_women_loop$loop_de_rad3_degree,
         alternative = "less",
         conf.level = 0.95,
         method = "spearman")
```



Estradiol sample size: Women: *n* = 31 (Pre: *n* = 13; Peri: *n* = 10; Post: *n* = 9)

Progesterone and FSH sample size: *n* = 26 (Pre: *n* = 12; Peri: *n* = 7; Post: *n* = 7)

No significant correlations for position error or degrees traveled using two-tailed or one-tailed tests (estradiol = "greater"; progesterone and FSH = "less).


## Other Analyses

### Table 1 Sex Differences

For Table 1 in the Google Doc, I want to check if there are any sex differences between men and women for the different navigation variables.


```{r post-dsp}
#Based on sample size from compelted

### DSP ###
t.test(aim1_men_dsp$dsp_success_pct,
       aim1_women_dsp$dsp_success_pct, conf.level = 0.95) #p = 0.028

#After checking differences in table for men vs women
#both non-normal so use Wilcoxon rank sum
wilcox.test(aim1_men_dsp$dsp_si_true_pct,
            aim1_women_dsp$dsp_si_true_pct, 
            paired=FALSE, exact=FALSE, conf.int=TRUE, conf.level = 0.95) #p=0.135
median(aim1_men_dsp$dsp_si_true_pct) #0.1818182
median(aim1_women_dsp$dsp_si_true_pct) #0.25
```


```{r post-analyses, include=FALSE}
######### Sex differences

### LOOP ###

#Radius 3: n=31 for women and n=19 men

#Position error at radius 3
t.test(aim1_men_loop$loop_pe_rad3_m,
       aim1_women_loop$loop_pe_rad3_m, conf.level = 0.95) #p = 0.6086

#Degrees at radius 3
wilcox.test(aim1_men_loop$loop_de_rad3_degree,
            aim1_women_loop$loop_de_rad3_degree, 
            paired=FALSE, exact=FALSE, conf.int=TRUE, conf.level = 0.95) #p=0.01146
median(aim1_men_loop$loop_de_rad3_degree, na.rm=TRUE) #317.7333
median(aim1_women_loop$loop_de_rad3_degree, na.rm=TRUE) #397.1856


#outlier removed for men so they are n=18, and normal so use t-test
t.test(men_loop_no354$loop_de_rad3_degree,
       aim1_women_loop$loop_de_rad3_degree, conf.level = 0.95) #p=0.003443



### MAZE ###
#Accuracy
wilcox.test(aim1_men_maze$maze_accuracy_pct,
            aim1_women_maze$maze_accuracy_pct, 
            paired=FALSE, exact=FALSE, conf.int=TRUE, conf.level = 0.95) #p=0.1231

#Moves
wilcox.test(aim1_men_maze$maze_moves,
            aim1_women_maze$maze_moves, 
            paired=FALSE, exact=FALSE, conf.int=TRUE, conf.level = 0.95) #p=0.09023



```


For Table 1 in the Google doc, calculating t-test or Wilcoxon rank sum test to test sex differences for spatial navigation measures reveal that there is a sex difference for DSP wayfinding success (men were more successful at reaching target) and LOOP degrees traveled (men travel fewer degrees on circular path).



# Summary


- Men were tested separately for the relationship between testosterone and spatial navigation behaviors, while women were tested for the relationships between estradiol, progesterone, FSH and spatial navigation behaviors.

- Estradiol, progesterone, and FSH were skewed, so associations with these hormones were using Spearman rank correlations.

- No significant correlations for LOOP or MAZE variables among women or men.

- While there were no significant correlations for DSP wayfinding success, there was a positive correlation between estradiol and solution index ($\rho$ = 0.421, *p* < 0.01, Spearman, one-tailed test), and a negative correlation between FSH and solution index ($\rho$ = -0.281, *p* < 0.05, Spearman, one-tailed test). There was no significant correlation with progesterone and solution index ($\rho$ = 0.161, *p* = 0.86, Spearman, one-tailed test). 

- Kruskla-Wallis test reveals that DSP solution index by reproductive status was not significant. 

- When using FSH to estradiol (FSH:E) ratio as a single measure for hormone concentration, the relationship with DSP solution index remained significant ($\rho$ = -0.381, *p* < 0.01, Spearman, one-tailed test).

- Proportion of place and response strategies used in the DSP task were displayed for all groups (men, women, pre, peri, post), revealing that pres on average use more place strategies (more than men) and they also on average use fewer response strategies based on descriptive statistics and plot.


