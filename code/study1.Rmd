---
title: 'Study 1: Hormones and Behavior'
author: "Shuying Yu"
date: "7/22/2022"
output: html_document
---

```{r setup, include=FALSE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE,
                      include = FALSE)

#Attach libraries
library(tidyverse)
library(here)
library(janitor)
library(ggpubr)
library(patchwork)
library(kableExtra)
library(foreign)
library(RColorBrewer)
library(plotly)
library(readr)
```


# Introduction


Study 1 aims to investigate the relationship between sex hormones and spatial navigation behavior in midlife women and men.

# Research Question

Do sex hormones (estradiol, FSH) covary with dependent variables in each spatial navigation task (LOOP, MAZE, DSP) for midlife women and men?

**Prediction:** The decline in ovarian estradiol production in midlife women will be associated with a shift in performance characteristics across spatial navigation paradigms, including more position errors in the LOOP task, fewer correct targets in the MAZE task, and an increased reliance on response-based strategies in the DSP task. For men, I hypothesize that lower testosterone concentrations will also be associated with more position errors in the LOOP task, fewer correct targets in the MAZE task, and an increased reliance on response-based strategies in the DSP task. 


Does the ratio of E/FSH among midlife women covary with position error in LOOP, accuracy in MAZE, or navigation strategy in DSP?

**Prediction:** Women with higher ratio of FSH to E (estradiol) will have more position errors in LOOP, less accuracy in MAZE, and more likely to use response-based strategies in DSP compared to women with higher E to FSH.


Another aim is to characterize the change in spatial navigation behavior for men and women from young to midlife. Using data collection from young adults (SNAG, OHS, HAS),I will plot how changes in behavior change with age for mainly women and men.

# Methods

## Participants

Midlife Adults

```{r}
#Table for final sample and age mean, sd for Aim 1
df_all <- read_csv(here("data", "HAS_SNAG_mastersheet_tidy.csv"))

#Filter for those with SNAG data
aim1 <- df_all %>% filter(completed_spatial == "Yes",
                          age_group == "Midlife")

#Table overall
tab_overall <- aim1 %>% 
  group_by(sex) %>% 
  summarize(n_subject = n(),
            age_mean = mean(age_spatial_years),
            age_Sd = sd(age_spatial_years))

#Table LOOP
tab_loop <- aim1 %>% 
  filter(loop_useable == "Yes") %>% 
  group_by(sex) %>% 
  summarize(n_subject = n(),
            age_mean = mean(age_spatial_years),
            age_Sd = sd(age_spatial_years))

#Table MAZE
tab_maze <- aim1 %>% 
  filter(maze_useable == "Yes") %>% 
  group_by(sex) %>% 
  summarize(n_subject = n(),
            age_mean = mean(age_spatial_years),
            age_Sd = sd(age_spatial_years))


#Table DSP
tab_dsp <- aim1 %>% 
  filter(dsp_useable == "Yes") %>% 
  group_by(sex) %>% 
  summarize(n_subject = n(),
            age_mean = mean(age_spatial_years),
            age_Sd = sd(age_spatial_years))


#Join df based on sex
tab1 <- merge(tab_overall, tab_loop, by = "sex")

#Rename columns
tab1 <- tab1 %>% 
  rename(n_subject_overall = n_subject.x,
         age_mean_overall = age_mean.x,
         age_sd_overall = age_Sd.x,
         n_subject_loop = n_subject.y,
         age_mean_loop = age_mean.y,
         age_sd_loop = age_Sd.y)

#Rest of the merge
tab2 <- merge(tab1, tab_maze, by = "sex")
tab_final <- merge(tab2, tab_dsp, by = "sex")

#Rename columns
tab_final <- tab_final %>% 
  rename(n_subject_maze = n_subject.x,
         age_mean_maze = age_mean.x,
         age_sd_maze = age_Sd.x,
         n_subject_dsp = n_subject.y,
         age_mean_dsp = age_mean.y,
         age_sd_dsp = age_Sd.y)


#Kable presentation
tab_final %>% 
  kable()
```



Young Adults

```{r}
#Filter for those with SNAG data
ya <- df_all %>% filter(completed_spatial == "Yes",
                    age_group == "Young")
```



## Task Paradigms

Same as in *Yu et al. (2021)*, with focus on Dual-Solution Paradigm (DSP) and Maze Learning Task (MAZE).

Hormones are testosterone for men, and estradiol and FSH for women. Hormones are taken during time of spatial navigation task.


# Results


## Men: Hormone and Behavior Correlations


```{r}
#Filter for men
aim1_men <- aim1 %>% filter(sex == "Male")
```


```{r normality-check-men}
shapiro.test(aim1_men$dsp_si_true_pct) #yes
shapiro.test(aim1_men$dsp_success_pct) #no
shapiro.test(aim1_men$maze_accuracy_pct) #yes
shapiro.test(aim1_men$maze_moves) #no
shapiro.test(aim1_men$loop_pe_avg_m) #no
shapiro.test(aim1_men$loop_de_avg_degree) #no
shapiro.test(aim1_men$testosterone_spatial_ng_dl) #no
```


Spearman rank correlation needed for DSP solution index, MAZE accuracy.

Here, only testosterone was tested for men (normally distributed).
 
 
### LOOP

```{r}
########## Pearson for position error
cor.test(aim1_men$testosterone_spatial_ng_dl,
         aim1_men$loop_pe_avg_m,
         conf.level = 0.95,
         method = "pearson")

########## Pearson for degrees traveled
cor.test(aim1_men$testosterone_spatial_ng_dl,
         aim1_men$loop_de_avg_degree,
         conf.level = 0.95,
         method = "pearson")

```
No correlations for position error and degrees traveled 

```{r men-loop-log}
########## Pearson for position error
cor.test(log(aim1_men$testosterone_spatial_ng_dl),
         aim1_men$loop_pe_avg_m,
         conf.level = 0.95,
         method = "pearson")

########## Pearson for degrees traveled
cor.test(log(aim1_men$testosterone_spatial_ng_dl),
         aim1_men$loop_de_avg_degree,
         conf.level = 0.95,
         method = "pearson")

```

When testosterone was logged, no correlations for LOOP.

### MAZE

```{r}
########## spearman for accuracy
cor.test(aim1_men$testosterone_spatial_ng_dl,
         aim1_men$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")


########## Pearson for moves
cor.test(aim1_men$testosterone_spatial_ng_dl,
         aim1_men$maze_moves,
         conf.level = 0.95,
         method = "pearson")
```

No correlations for accuracy or moves


```{r men-maze-log}
########## spearman for accuracy
cor.test(log(aim1_men$testosterone_spatial_ng_dl),
         aim1_men$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")


########## Pearson for moves
cor.test(log(aim1_men$testosterone_spatial_ng_dl),
         aim1_men$maze_moves,
         conf.level = 0.95,
         method = "pearson")
```
No correlations for accuracy or moves

 
### DSP

```{r}
########## pearson for wayfinding success
cor.test(aim1_men$testosterone_spatial_ng_dl,
         aim1_men$dsp_success_pct,
         conf.level = 0.95,
         method = "pearson")

########## spearman for si
cor.test(aim1_men$testosterone_spatial_ng_dl,
         aim1_men$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")
```
No correlations for wayfinding success or SI

```{r men-dsp-log}
########## pearson for wayfinding success
cor.test(log(aim1_men$testosterone_spatial_ng_dl),
         aim1_men$dsp_success_pct,
         conf.level = 0.95,
         method = "pearson")

########## spearman for si
cor.test(log(aim1_men$testosterone_spatial_ng_dl),
         aim1_men$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")
```



## Women: Hormone and Behavior Correlations

Hormones bar plot

```{r}
#Filter for women
aim1_women <- aim1 %>% 
  filter(sex == "Female") %>% 
  #Reorder repo status
  mutate(repo_status_spatial = fct_relevel(repo_status_spatial, 
                                         c("Pre", "Peri", "Post")))


#Summary of hormones
ehormones_fig <- aim1_women %>% 
  group_by(repo_status_spatial) %>% 
  summarize(mean_estradiol = mean(estradiol_spatial_pg_ml),
            sd_estradiol = sd(estradiol_spatial_pg_ml),
            n_estradiol = n(),
            se_estradiol = sd(estradiol_spatial_pg_ml)/sqrt(n()), 
            .groups = "keep")

fhormones_fig <- aim1_women %>% 
  group_by(repo_status_spatial) %>% 
  summarize(mean_estradiol = mean(fsh_spatial_miu_ml),
            sd_estradiol = sd(fsh_spatial_miu_ml),
            n_estradiol = n(),
            se_estradiol = sd(fsh_spatial_miu_ml)/sqrt(n()), 
            .groups = "keep")
```


```{r hormone-plot}
#Estradiol plot
ggplot(data = aim1_women, aes(x = repo_status_spatial, 
                            y = estradiol_spatial_pg_ml, 
                            fill = repo_status_spatial))+
  
  #Define bar plot by mean
  geom_bar(stat="summary", fun= "mean",
           show.legend = FALSE)+ 
  
  #Add SEM errorbar
  stat_summary(geom = "errorbar", 
               fun.data = mean_se,
               width = 0.15, size = 0.7)+
  
  #Change labels
  labs(x = "Reproductive Status",
       y = expression(atop(paste(bold("17"),
                                 bold(beta),
                                 bold("-Estradiol (pg/mL)")),
                           )),
       tag = "A") +
  
  #Change colors of bars
  #Reverse color scale
  scale_fill_brewer(palette = "RdPu",
                    direction = -1)+
  
  #Change theme
  theme_classic() +
  
  #Customize theme
  theme(axis.title = element_text(size = 11, face = "bold"), 
        axis.text = element_text(size= 10))

#ggsave("estradiol_bar.png")


#FSH plot
ggplot(data = aim1_women, aes(x = repo_status_spatial, 
                            y = fsh_spatial_miu_ml, 
                            fill = repo_status_spatial))+
  
  #Define bar plot by mean
  geom_bar(stat="summary", fun= "mean",
           show.legend = FALSE)+ 
  
  #Add SEM errorbar
  stat_summary(geom = "errorbar", 
               fun.data = mean_se,
               width = 0.15, size = 0.7)+
  
  #Change labels
  labs(x = "Reproductive Status",
       y = "FSH (mIU/mL)\n",
       tag = "B") +
  
  #Change colors of bars
  #Reverse color scale
  scale_fill_brewer(palette = "RdPu",
                    direction = -1)+
  
  #Change theme
  theme_classic() +
  
  #Customize theme
  theme(axis.title = element_text(size = 11, face = "bold"), 
        axis.text = element_text(size= 10))

#ggsave("fsh_bar.png")
```



```{r}
#ANOVA of hormones
hormone_mod <- aov(estradiol_spatial_pg_ml ~ repo_status_spatial,
      data = aim1_women)
TukeyHSD(hormone_mod)

hormone_mod2 <- aov(fsh_spatial_miu_ml ~ repo_status_spatial,
      data = aim1_women)
TukeyHSD(hormone_mod2)
```
Estradiol is statistivcally significant between all pairs of reproductive groups, as well as FSH.



```{r normality-check-women}
shapiro.test(aim1_women$dsp_si_true_pct) #yes
shapiro.test(aim1_women$dsp_success_pct) #no
shapiro.test(aim1_women$maze_accuracy_pct) #yes
shapiro.test(aim1_women$maze_moves) #yes
shapiro.test(aim1_women$loop_pe_avg_m) #no
shapiro.test(aim1_women$loop_de_avg_degree) #no
shapiro.test(aim1_women$estradiol_spatial_pg_ml) #yes
shapiro.test(aim1_women$progesterone_spatial_ng_ml) #yes
shapiro.test(aim1_women$fsh_spatial_miu_ml) #yes
```


LOOP dependent variables were not significant as well as DSP wayfinding success, but all other variables were significant, meaning that the normality assumption was violated.


### LOOP


```{r}
########## Spearman for position error
cor.test(aim1_women$estradiol_spatial_pg_ml,
         aim1_women$loop_pe_avg_m,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(aim1_women$fsh_spatial_miu_ml,
         aim1_women$loop_pe_avg_m,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for degrees traveled
cor.test(aim1_women$estradiol_spatial_pg_ml,
         aim1_women$loop_de_avg_degree,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(aim1_women$fsh_spatial_miu_ml,
         aim1_women$loop_de_avg_degree,
         conf.level = 0.95,
         method = "spearman")
```
No correlations for position error and degrees traveled

```{r women-loop-log}
########## Spearman for position error
cor.test(log(aim1_women$estradiol_spatial_pg_ml),
         aim1_women$loop_pe_avg_m,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(log(aim1_women$fsh_spatial_miu_ml),
         aim1_women$loop_pe_avg_m,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for degrees traveled
cor.test(log(aim1_women$estradiol_spatial_pg_ml),
         aim1_women$loop_de_avg_degree,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(log(aim1_women$fsh_spatial_miu_ml),
         aim1_women$loop_de_avg_degree,
         conf.level = 0.95,
         method = "spearman")
```


### MAZE

```{r}
########## Spearman for wayfinding success

#Estradiol
cor.test(aim1_women$estradiol_spatial_pg_ml,
         aim1_women$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(aim1_women$fsh_spatial_miu_ml,
         aim1_women$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for moves

#Estradiol
cor.test(aim1_women$estradiol_spatial_pg_ml,
         aim1_women$maze_moves,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(aim1_women$fsh_spatial_miu_ml,
         aim1_women$maze_moves,
         conf.level = 0.95,
         method = "spearman")
```
No correlations for accuracy or moves made


```{r women-maze-log}
########## Spearman for wayfinding success

#Estradiol
cor.test(log(aim1_women$estradiol_spatial_pg_ml),
         aim1_women$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(log(aim1_women$fsh_spatial_miu_ml),
         aim1_women$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for moves

#Estradiol
cor.test(log(aim1_women$estradiol_spatial_pg_ml),
         aim1_women$maze_moves,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(log(aim1_women$fsh_spatial_miu_ml),
         aim1_women$maze_moves,
         conf.level = 0.95,
         method = "spearman")
```


Still no significant correlations

### DSP

```{r}

########## Spearman for wayfinding success

#Estradiol
cor.test(aim1_women$estradiol_spatial_pg_ml,
         aim1_women$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")

#Progesterone
cor.test(aim1_women$progesterone_spatial_ng_ml,
         aim1_women$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(aim1_women$fsh_spatial_miu_ml,
         aim1_women$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for solution index

#Estradiol
cor.test(aim1_women$estradiol_spatial_pg_ml,
         aim1_women$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")

#Progesterone
cor.test(aim1_women$progesterone_spatial_ng_ml,
         aim1_women$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(aim1_women$fsh_spatial_miu_ml,
         aim1_women$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")
```


No correlation for wayfinding success, but significant correlation for solution index for E and FSH.



```{r dsp-plot}
#Filter for DSP
aim1_women_dsp <- aim1 %>% 
  filter(sex == "Female", dsp_useable == "Yes") %>% 
  #Reorder repo status
  mutate(repo_status_spatial = fct_relevel(repo_status_spatial, 
                                         c("Pre", "Peri", "Post"))) 



#E and FSH plot with SI
a <- ggplot(data = aim1_women_dsp, aes(x = estradiol_spatial_pg_ml,
                                        y = dsp_si_true_pct)) +
  
  #Define scatter, change size and alpha
  geom_point(aes(color = repo_status_spatial),
             size = 3, alpha = 0.6, show.legend = FALSE) +
  
  #Add LM line
  geom_smooth(method = "lm", se = FALSE,
              color = "grey50") +
  
  #Change labels
  labs(x = expression(paste(bold("17"),
                                 bold(beta),
                                 bold("-Estradiol (pg/mL)")),
                           ),
       y = "Solution Index (%)\n",
       color = "Reproductive Status") +
  
  #Change color of points
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  theme_minimal() +
  
  #Customize theme
  theme(axis.title = element_text(size = 11, face = "bold"), 
        axis.title.x = element_text(vjust = -0.5),
        axis.text = element_text(size= 10))



b <- ggplot(data = aim1_women_dsp, aes(x = fsh_spatial_miu_ml,
                            y = dsp_si_true_pct,
                            color = repo_status_spatial)) +
  
  #Define scatter, change size and alpha
  geom_point(aes(color = repo_status_spatial),
             size = 3, alpha = 0.6) +
  
  #Add LM line
  geom_smooth(method = "lm", se = FALSE,
              color = "grey50") +
  
  #Change labels
  labs(x = "\nFollicle Stimulating Hormone (mIU/mL)",
       y = " ",
       color = "Reproductive Status") +
  
  #Change color of points
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  theme_minimal() +
  
  #Customize theme
  theme(axis.title = element_text(size = 11, face = "bold"),
        axis.title.x = element_text(vjust = 2),
        axis.text = element_text(size= 10),
        
        #Legend
        #legend.title = element_text(face = "bold"),
        legend.position = "top"
        
        )


#Combine
combined <- a + b & theme(legend.position = "top")
combined + plot_layout(guides = "collect")

#save
#ggsave("study1_dsp_si_e_fsh_spatial.png")
```



```{r women-dsp-log}

########## Spearman for wayfinding success

#Estradiol
cor.test(log(aim1_women$estradiol_spatial_pg_ml),
         aim1_women$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(log(aim1_women$fsh_spatial_miu_ml),
         aim1_women$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for solution index

#Estradiol
cor.test(log(aim1_women$estradiol_spatial_pg_ml),
         aim1_women$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(log(aim1_women$fsh_spatial_miu_ml),
         aim1_women$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")
```

When estradiol and FSH are logged, and then Spearman rank correlation administered, the results for solution index remained significant for estradiol and marginal for FSH.


## Women: Hormone (Scan) and Behavior Correlations

Hormones bar plot

```{r}
#Filter for women
aim1_women <- aim1 %>% 
  filter(sex == "Female") %>% 
  #Reorder repo status
  mutate(repo_status_scan = fct_relevel(repo_status_scan, 
                                         c("Pre", "Peri", "Post")))


#Summary of hormones
ehormones_fig <- aim1_women %>% 
  group_by(repo_status_scan) %>% 
  summarize(mean_estradiol = mean(estradiol_scan_pg_ml),
            sd_estradiol = sd(estradiol_scan_pg_ml),
            n_estradiol = n(),
            se_estradiol = sd(estradiol_scan_pg_ml)/sqrt(n()), 
            .groups = "keep")

fhormones_fig <- aim1_women %>% 
  group_by(repo_status_scan) %>% 
  summarize(mean_estradiol = mean(fsh_scan_miu_ml),
            sd_estradiol = sd(fsh_scan_miu_ml),
            n_estradiol = n(),
            se_estradiol = sd(fsh_scan_miu_ml)/sqrt(n()), 
            .groups = "keep")
```


```{r hormone-plot}
#Estradiol plot
ggplot(data = aim1_women, aes(x = repo_status_scan, 
                            y = estradiol_scan_pg_ml, 
                            fill = repo_status_scan))+
  
  #Define bar plot by mean
  geom_bar(stat="summary", fun= "mean",
           show.legend = FALSE)+ 
  
  #Add SEM errorbar
  stat_summary(geom = "errorbar", 
               fun.data = mean_se,
               width = 0.15, size = 0.7)+
  
  #Change labels
  labs(x = "Reproductive Status",
       y = expression(atop(paste(bold("17"),
                                 bold(beta),
                                 bold("-Estradiol (pg/mL)")),
                           )),
       tag = "A") +
  
  #Change colors of bars
  #Reverse color scale
  scale_fill_brewer(palette = "RdPu",
                    direction = -1)+
  
  #Change theme
  theme_classic() +
  
  #Customize theme
  theme(axis.title = element_text(size = 11, face = "bold"), 
        axis.text = element_text(size= 10))

#ggsave("estradiol_bar.png")


#FSH plot
ggplot(data = aim1_women, aes(x = repo_status_scan, 
                            y = fsh_scan_miu_ml, 
                            fill = repo_status_scan))+
  
  #Define bar plot by mean
  geom_bar(stat="summary", fun= "mean",
           show.legend = FALSE)+ 
  
  #Add SEM errorbar
  stat_summary(geom = "errorbar", 
               fun.data = mean_se,
               width = 0.15, size = 0.7)+
  
  #Change labels
  labs(x = "Reproductive Status",
       y = "FSH (mIU/mL)\n",
       tag = "B") +
  
  #Change colors of bars
  #Reverse color scale
  scale_fill_brewer(palette = "RdPu",
                    direction = -1)+
  
  #Change theme
  theme_classic() +
  
  #Customize theme
  theme(axis.title = element_text(size = 11, face = "bold"), 
        axis.text = element_text(size= 10))

#ggsave("fsh_bar.png")
```


```{r}
#ANOVA of hormones
hormone_mod <- aov(estradiol_scan_pg_ml ~ repo_status_scan,
      data = aim1_women)
TukeyHSD(hormone_mod)

hormone_mod2 <- aov(fsh_scan_miu_ml ~ repo_status_scan,
      data = aim1_women)
TukeyHSD(hormone_mod2)
```
Estradiol is statistivcally significant between all pairs of reproductive groups except (pre and peri), as well as FSH.



```{r normality-check-women-scan}
shapiro.test(aim1_women$estradiol_scan_pg_ml) #yes
shapiro.test(aim1_women$fsh_scan_miu_ml) #yes
```

### LOOP


```{r}
########## Spearman for position error
cor.test(aim1_women$estradiol_scan_pg_ml,
         aim1_women$loop_pe_avg_m,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(aim1_women$fsh_scan_miu_ml,
         aim1_women$loop_pe_avg_m,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for degrees traveled
cor.test(aim1_women$estradiol_scan_pg_ml,
         aim1_women$loop_de_avg_degree,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(aim1_women$fsh_scan_miu_ml,
         aim1_women$loop_de_avg_degree,
         conf.level = 0.95,
         method = "spearman")
```

```{r women-loop-log2}
########## Spearman for position error
cor.test(log(aim1_women$estradiol_scan_pg_ml),
         aim1_women$loop_pe_avg_m,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(log(aim1_women$fsh_scan_miu_ml),
         aim1_women$loop_pe_avg_m,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for degrees traveled
cor.test(log(aim1_women$estradiol_scan_pg_ml),
         aim1_women$loop_de_avg_degree,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(log(aim1_women$fsh_scan_miu_ml),
         aim1_women$loop_de_avg_degree,
         conf.level = 0.95,
         method = "spearman")
```
No correlations for LOOP.


### MAZE


```{r}
########## Spearman for wayfinding success

#Estradiol
cor.test(aim1_women$estradiol_scan_pg_ml,
         aim1_women$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(aim1_women$fsh_scan_miu_ml,
         aim1_women$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for moves

#Estradiol
cor.test(aim1_women$estradiol_scan_pg_ml,
         aim1_women$maze_moves,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(aim1_women$fsh_scan_miu_ml,
         aim1_women$maze_moves,
         conf.level = 0.95,
         method = "spearman")
```

```{r women-maze-log2}
########## Spearman for wayfinding success

#Estradiol
cor.test(log(aim1_women$estradiol_scan_pg_ml),
         aim1_women$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(log(aim1_women$fsh_scan_miu_ml),
         aim1_women$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for moves

#Estradiol
cor.test(log(aim1_women$estradiol_scan_pg_ml),
         aim1_women$maze_moves,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(log(aim1_women$fsh_scan_miu_ml),
         aim1_women$maze_moves,
         conf.level = 0.95,
         method = "spearman")
```


Still no significant correlations

### DSP

```{r}

########## Spearman for wayfinding success

#Estradiol
cor.test(aim1_women$estradiol_scan_pg_ml,
         aim1_women$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(aim1_women$fsh_scan_miu_ml,
         aim1_women$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for solution index

#Estradiol
cor.test(aim1_women$estradiol_scan_pg_ml,
         aim1_women$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(aim1_women$fsh_scan_miu_ml,
         aim1_women$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")
```
DSP solution index with estradiol from scan remains significant, and marginal with FSH from scan.



```{r dsp-plot2}
#Filter for DSP
aim1_women_dsp <- aim1 %>% 
  filter(sex == "Female", dsp_useable == "Yes") %>% 
  #Reorder repo status
  mutate(repo_status_scan = fct_relevel(repo_status_scan, 
                                         c("Pre", "Peri", "Post"))) 



#E and FSH plot with SI
a <- ggplot(data = aim1_women_dsp, aes(x = estradiol_scan_pg_ml,
                                        y = dsp_si_true_pct)) +
  
  #Define scatter, change size and alpha
  geom_point(aes(color = repo_status_scan),
             size = 3, alpha = 0.6, show.legend = FALSE) +
  
  #Add LM line
  geom_smooth(method = "lm", se = FALSE,
              color = "grey50") +
  
  #Change labels
  labs(x = expression(paste(bold("17"),
                                 bold(beta),
                                 bold("-Estradiol (pg/mL)")),
                           ),
       y = "Solution Index (%)\n",
       color = "Reproductive Status") +
  
  #Change color of points
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  theme_minimal() +
  
  #Customize theme
  theme(axis.title = element_text(size = 11, face = "bold"), 
        axis.title.x = element_text(vjust = -0.5),
        axis.text = element_text(size= 10))



b <- ggplot(data = aim1_women_dsp, aes(x = fsh_scan_miu_ml,
                            y = dsp_si_true_pct,
                            color = repo_status_scan)) +
  
  #Define scatter, change size and alpha
  geom_point(aes(color = repo_status_scan),
             size = 3, alpha = 0.6) +
  
  #Add LM line
  geom_smooth(method = "lm", se = FALSE,
              color = "grey50") +
  
  #Change labels
  labs(x = "\nFollicle Stimulating Hormone (mIU/mL)",
       y = " ",
       color = "Reproductive Status") +
  
  #Change color of points
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  theme_minimal() +
  
  #Customize theme
  theme(axis.title = element_text(size = 11, face = "bold"),
        axis.title.x = element_text(vjust = 2),
        axis.text = element_text(size= 10),
        
        #Legend
        #legend.title = element_text(face = "bold"),
        legend.position = "top"
        
        )


#Combine
combined <- a + b & theme(legend.position = "top")
combined + plot_layout(guides = "collect")

#save
#ggsave("study1_dsp_si_e_fsh.png")
```



```{r women-dsp-log2}

########## Spearman for wayfinding success

#Estradiol
cor.test(log(aim1_women$estradiol_scan_pg_ml),
         aim1_women$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(log(aim1_women$fsh_scan_miu_ml),
         aim1_women$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for solution index

#Estradiol
cor.test(log(aim1_women$estradiol_scan_pg_ml),
         aim1_women$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")

#FSH
cor.test(log(aim1_women$fsh_scan_miu_ml),
         aim1_women$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")
```



## Estradiol to FSH ratio (spatial) in Midlife Women

```{r}

#Midlife women

#Create new column with ratio
aim1_women <- aim1_women %>% 
  mutate(e_fsh_ratio = estradiol_spatial_pg_ml/fsh_spatial_miu_ml,
         fsh_e_ratio = fsh_spatial_miu_ml/estradiol_spatial_pg_ml)


#Filter for DSP
aim1_women_dsp <- aim1_women %>% 
  filter(sex == "Female", dsp_useable == "Yes") %>% 
  #Reorder repo status
  mutate(repo_status_spatial = fct_relevel(repo_status_spatial, 
                                         c("Pre", "Peri", "Post"))) 
  

#Plot E:FSH ratio and solution index
ggplot(data = aim1_women_dsp, aes(x = e_fsh_ratio,
                            y = dsp_si_true_pct,
                            text = subject_id)) +
  
  #Define scatter, change size and alpha
  geom_point(aes(color = repo_status_spatial),
             size = 3, alpha = 0.6) +
  
  #Add LM line
  geom_smooth(method = "lm", se = FALSE,
              color = "grey50") +
  
  #Change labels
  labs(x = "\nEstradiol to FSH Ratio",
       y = "Solution Index",
       color = "Reproductive Status") +
  
  #Change color of points
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  theme_minimal() +
  
  #Customize theme
  theme(axis.title = element_text(size = 11, face = "bold"),
        axis.title.x = element_text(vjust = 2),
        axis.text = element_text(size= 10),
        
        #Legend
        #legend.title = element_text(face = "bold"),
        legend.position = "top")




#Plot FSH:E ratio and solution index
ggplot(data = aim1_women_dsp, aes(x = fsh_e_ratio,
                            y = dsp_si_true_pct,
                            text = subject_id)) +
  
  #Define scatter, change size and alpha
  geom_point(aes(color = repo_status_spatial),
             size = 3, alpha = 0.6) +
  
  #Add LM line
  geom_smooth(method = "lm", se = FALSE,
              color = "grey50") +
  
  #Change labels
  labs(x = "\nFSH to Estradiol Ratio",
       y = "Solution Index",
       color = "Reproductive Status") +
  
  #Change color of points
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  theme_minimal() +
  
  #Customize theme
  theme(axis.title = element_text(size = 11, face = "bold"),
        axis.title.x = element_text(vjust = 2),
        axis.text = element_text(size= 10),
        
        #Legend
        #legend.title = element_text(face = "bold"),
        legend.position = "top")

```


```{r}
#Check distribution of E:FSH ratio (probably not normal)
shapiro.test(aim1_women$e_fsh_ratio) #yes
shapiro.test(log(aim1_women$e_fsh_ratio)) #yes

shapiro.test(aim1_women$fsh_e_ratio) #yes
shapiro.test(log(aim1_women$fsh_e_ratio)) #yes
```


All correlations need to be Spearman rank.


### LOOP

```{r}
#Correlation with E:FSH and FSH:E ratio

########## Spearman for position error

cor.test(aim1_women$e_fsh_ratio,
         aim1_women$loop_pe_avg_m,
         conf.level = 0.95,
         method = "spearman")

cor.test(aim1_women$fsh_e_ratio,
         aim1_women$loop_pe_avg_m,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for degrees traveled


cor.test(aim1_women$e_fsh_ratio,
         aim1_women$loop_de_avg_degree,
         conf.level = 0.95,
         method = "spearman")

cor.test(aim1_women$fsh_e_ratio,
         aim1_women$loop_de_avg_degree,
         conf.level = 0.95,
         method = "spearman")
```

### MAZE

```{r}
#Correlation with E:FSH ratio

########## Spearman for wayfinding success

cor.test(aim1_women$e_fsh_ratio,
         aim1_women$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")

cor.test(aim1_women$fsh_e_ratio,
         aim1_women$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for solution index


cor.test(aim1_women$e_fsh_ratio,
         aim1_women$maze_moves,
         conf.level = 0.95,
         method = "spearman")

cor.test(aim1_women$fsh_e_ratio,
         aim1_women$maze_moves,
         conf.level = 0.95,
         method = "spearman")
```

### DSP

```{r}
#Correlation with E:FSH ratio

########## Spearman for wayfinding success

cor.test(aim1_women$e_fsh_ratio,
         aim1_women$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")

cor.test(aim1_women$fsh_e_ratio,
         aim1_women$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")

########## Spearman for solution index


cor.test(aim1_women$e_fsh_ratio,
         aim1_women$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")

cor.test(aim1_women$fsh_e_ratio,
         aim1_women$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")
```

Solution index is still significant with the ratios 



## Estradiol to FSH ratio (scan) in Midlife Women

```{r}

#Midlife women
aim1_women <- aim1 %>% 
  filter(sex == "Female") %>% 
  #Reorder repo status
  mutate(repo_status_scan = fct_relevel(repo_status_scan, 
                                         c("Pre", "Peri", "Post")))

#Create new column with ratio
aim1_women <- aim1_women %>% 
  mutate(e_fsh_ratio = estradiol_scan_pg_ml/fsh_scan_miu_ml,
         fsh_e_ratio = fsh_scan_miu_ml/estradiol_scan_pg_ml)


#Filter for DSP
aim1_women_dsp <- aim1_women %>% 
  filter(sex == "Female", dsp_useable == "Yes") %>% 
  #Reorder repo status
  mutate(repo_status_scan = fct_relevel(repo_status_scan, 
                                         c("Pre", "Peri", "Post"))) 
  

#Plot E:FSH ratio and solution index
ggplot(data = aim1_women_dsp, aes(x = e_fsh_ratio,
                            y = dsp_si_true_pct,
                            text = subject_id)) +
  
  #Define scatter, change size and alpha
  geom_point(aes(color = repo_status_scan),
             size = 3, alpha = 0.6) +
  
  #Add LM line
  geom_smooth(method = "lm", se = FALSE,
              color = "grey50") +
  
  #Change labels
  labs(x = "\nEstradiol to FSH Ratio",
       y = "Solution Index",
       color = "Reproductive Status") +
  
  #Change color of points
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  theme_minimal() +
  
  #Customize theme
  theme(axis.title = element_text(size = 11, face = "bold"),
        axis.title.x = element_text(vjust = 2),
        axis.text = element_text(size= 10),
        
        #Legend
        #legend.title = element_text(face = "bold"),
        legend.position = "top")




#Plot FSH:E ratio and solution index
ggplot(data = aim1_women_dsp, aes(x = fsh_e_ratio,
                            y = dsp_si_true_pct,
                            text = subject_id)) +
  
  #Define scatter, change size and alpha
  geom_point(aes(color = repo_status_scan),
             size = 3, alpha = 0.6) +
  
  #Add LM line
  geom_smooth(method = "lm", se = FALSE,
              color = "grey50") +
  
  #Change labels
  labs(x = "\nFSH to Estradiol Ratio",
       y = "Solution Index",
       color = "Reproductive Status") +
  
  #Change color of points
  scale_color_manual(values = c("cadetblue4", "mediumvioletred", "darkorange")) +
  
  theme_minimal() +
  
  #Customize theme
  theme(axis.title = element_text(size = 11, face = "bold"),
        axis.title.x = element_text(vjust = 2),
        axis.text = element_text(size= 10),
        
        #Legend
        #legend.title = element_text(face = "bold"),
        legend.position = "top")

```


```{r}
#Check distribution of E:FSH ratio (probably not normal)
shapiro.test(aim1_women$e_fsh_ratio) #yes
shapiro.test(log(aim1_women$e_fsh_ratio)) #yes

shapiro.test(aim1_women$fsh_e_ratio) #yes
shapiro.test(log(aim1_women$fsh_e_ratio)) #yes
```


All correlations need to be Spearman rank.


### LOOP

```{r}
#Correlation with E:FSH and FSH:E ratio

########## Spearman for position error

cor.test(aim1_women$e_fsh_ratio,
         aim1_women$loop_pe_avg_m,
         conf.level = 0.95,
         method = "spearman")

cor.test(aim1_women$fsh_e_ratio,
         aim1_women$loop_pe_avg_m,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for degrees traveled


cor.test(aim1_women$e_fsh_ratio,
         aim1_women$loop_de_avg_degree,
         conf.level = 0.95,
         method = "spearman")

cor.test(aim1_women$fsh_e_ratio,
         aim1_women$loop_de_avg_degree,
         conf.level = 0.95,
         method = "spearman")
```

### MAZE

```{r}
#Correlation with E:FSH ratio

########## Spearman for wayfinding success

cor.test(aim1_women$e_fsh_ratio,
         aim1_women$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")

cor.test(aim1_women$fsh_e_ratio,
         aim1_women$maze_accuracy_pct,
         conf.level = 0.95,
         method = "spearman")


########## Spearman for solution index


cor.test(aim1_women$e_fsh_ratio,
         aim1_women$maze_moves,
         conf.level = 0.95,
         method = "spearman")

cor.test(aim1_women$fsh_e_ratio,
         aim1_women$maze_moves,
         conf.level = 0.95,
         method = "spearman")
```

### DSP

```{r}
#Correlation with E:FSH ratio

########## Spearman for wayfinding success

cor.test(aim1_women$e_fsh_ratio,
         aim1_women$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")

cor.test(aim1_women$fsh_e_ratio,
         aim1_women$dsp_success_pct,
         conf.level = 0.95,
         method = "spearman")

########## Spearman for solution index


cor.test(aim1_women$e_fsh_ratio,
         aim1_women$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")

cor.test(aim1_women$fsh_e_ratio,
         aim1_women$dsp_si_true_pct,
         conf.level = 0.95,
         method = "spearman")
```

Solution index is still significant with the ratios 






## Behavior for Young and Midlife

Visualizations

```{r}
#Combine dataframes
long_viz <- df_all %>% 
  select(subject_id, completed_spatial, sex, age_group,
         age_spatial_years, repo_status_spatial, straw_status,
         loop_useable:dsp_si_true_pct)
```


```{r}
#LOOP
long_viz_loop <- long_viz %>% 
  filter(loop_useable == "Yes")

#Scatterpot 
a1 <- ggplot(data = long_viz_loop, aes(x = age_spatial_years,
                                 y = loop_pe_avg_m)) +
  geom_point(aes(color = sex), size = 2, alpha = 0.6) +
  geom_smooth(aes(group = sex, color = sex), method = "lm", 
              formula = y ~ poly(x, 2),
              position = "identity") +
  labs(x = "Age (years)",
       y = "Mean position error (m)",
       color = "Sex") +
  theme_minimal()+
  theme(legend.position = c(0.3, 0.9))


a2 <- ggplot(data = long_viz_loop, aes(x = age_spatial_years,
                                 y = loop_de_avg_degree)) +
  geom_point(aes(color = sex), size = 2, alpha = 0.6,
             show.legend = FALSE) +
  geom_smooth(aes(group = sex, color = sex), method = "lm", 
              position = "identity", show.legend = FALSE) +
  labs(x = "Age (years)",
       y = "Mean degrees traveled",
       color = "Sex") +
  theme_minimal()

#Display combination
a1+a2
```



```{r}
#MAZE
long_viz_maze <- long_viz %>% 
  filter(maze_useable == "Yes")

#Scatterpot 
a1 <- ggplot(data = long_viz_maze, aes(x = age_spatial_years,
                                 y = maze_accuracy_pct)) +
  geom_point(aes(color = sex), size = 2, alpha = 0.6,
             show.legend = FALSE) +
  geom_smooth(aes(group = sex, color = sex), method = "lm", 
              position = "identity", show.legend = FALSE) +
  labs(x = "Age (years)",
       y = "Accuracy (%)",
       color = "Sex") +
  theme_minimal()

a2 <- ggplot(data = long_viz_maze, aes(x = age_spatial_years,
                                      y = maze_moves)) +
  geom_point(aes(color = sex), size = 2, alpha = 0.6) +
  geom_smooth(aes(group = sex, color = sex), method = "lm", position = "identity") +
  labs(x = "Age (years)",
       y = "Number of Moves",
       color = "Sex") +
  theme_minimal() +
  theme(legend.position = c(0.3, 0.1))

#Display
a1+a2
```


```{r}
#DSP
long_viz_dsp <- long_viz %>% 
  filter(dsp_useable == "Yes")

#Scatterpot with curve
a1 <- ggplot(data = long_viz_dsp, aes(x = age_spatial_years,
                                 y = dsp_success_pct)) +
  geom_point(aes(color = sex), size = 2, alpha = 0.6) +
  geom_smooth(aes(group = sex, color = sex), method = "lm", position = "identity") +
  labs(x = "Age (years)",
       y = "Wayfinding Success (%)",
       color = "Sex") +
  theme_minimal()+
  theme(legend.position = c(0.2, 0.1))

a2 <- ggplot(data = long_viz_dsp, aes(x = age_spatial_years,
                                 y = dsp_si_true_pct)) +
  geom_point(aes(color = sex), size = 2, alpha = 0.6,
             show.legend = FALSE) +
  geom_smooth(aes(group = sex, color = sex), method = "lm", 
              position = "identity", show.legend = FALSE) +
  labs(x = "Age (years)",
       y = "Solution Index (%)",
       color = "Sex") +
  theme_minimal() 

#Display
a1+a2
```




# Summary


- Men were tested separately for the relationship between testosterone and spatial navigation behaviors, while women were tested for the relationships between estradiol/FSH and spatial navigation behaviors.

- No significant correlations among men.

- Estradiol and FSH were skewed, so the hormones were log transformed and associations with these hormones were using Spearman rank correlations.

- No significant correlations for MAZE among women.

- While there were no significant correlations for DSP wayfinding success, there was a positive correlation between estradiol and solution index (*p* = 0.018, Spearman), and a marginal negative association between FSH and solution index (*p* = 0.058, Spearman). This was true when using hormone measurements from both spatial and scan timepoints. The statistics reported in this summary are using the hormones from the scan. 

- When using spatial hormones, positive correlation between estradiol and solution index (*p* < 0.01, Spearman), and a marginal negative association between FSH and solution index (*p* = 0.058, Spearman) show to have similar results.

- When using estradiol to FSH ratio (or FSH to estradiol ratio) as a measure of hormones, DSP solution index remained significant (for both spatial and scan hormones).


